<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Fantasy GOAT</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
<style>
:root{--black:#000;--gold:#EFB810;--gdim:rgba(239,184,16,.15);--gglow:rgba(239,184,16,.35);--white:#fff;--card:#111;--card2:#161616;--gray:#888;--gl:#aaa;--green:#2ECC71;--red:#E74C3C}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{font-family:'Montserrat',sans-serif;background:#0a0a0a;display:flex;justify-content:center;align-items:center;overflow:hidden}
.phone{width:390px;height:844px;background:var(--black);border-radius:44px;overflow:hidden;position:relative;box-shadow:0 0 0 2px #222,0 0 60px rgba(239,184,16,.08),0 40px 80px rgba(0,0,0,.9);flex-shrink:0}
@media(max-width:500px){body{display:block}.phone{width:100vw;height:100svh;border-radius:0;box-shadow:none}.sb{display:none}.screen{top:0!important}}
.sb{height:44px;background:var(--black);display:flex;align-items:center;justify-content:space-between;padding:0 24px;z-index:100;flex-shrink:0}
.sb .time{font-size:15px;font-weight:700;color:var(--white)}
.sb .icons{display:flex;gap:6px;align-items:center;color:var(--white);font-size:13px}
.screen{position:absolute;top:44px;left:0;right:0;bottom:0;background:var(--black);overflow:hidden;opacity:0;pointer-events:none;transform:translateX(30px);transition:opacity .32s cubic-bezier(.4,0,.2,1),transform .32s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column}
.screen-scroll{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain;scrollbar-width:none}
.screen-scroll::-webkit-scrollbar{display:none}
.screen.full-scroll{overflow-y:auto;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}
.screen.active{opacity:1;pointer-events:all;transform:translateX(0)}
.screen.prev{opacity:0;transform:translateX(-30px);pointer-events:none}
.bnav{background:rgba(6,6,6,.97);backdrop-filter:blur(20px);border-top:1px solid #1a1a1a;display:flex;align-items:center;justify-content:space-around;padding:10px 8px 24px;flex-shrink:0;z-index:50}
.ni{display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;padding:6px 10px;border-radius:12px;transition:all .2s}
.ni .icon{font-size:20px;color:var(--gray);transition:all .2s}
.ni .lbl{font-size:9px;letter-spacing:.5px;color:var(--gray);text-transform:uppercase;font-weight:600;transition:all .2s}
.ni.active .icon,.ni.active .lbl{color:var(--gold)}
.ni.active .icon{filter:drop-shadow(0 0 6px var(--gglow))}
.nc{width:52px;height:52px;background:var(--gold);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;box-shadow:0 0 20px var(--gglow);transition:all .2s;margin-bottom:8px}
.nc:active{transform:scale(.93)}
.nc.active{box-shadow:0 0 28px rgba(239,184,16,.6)}
.lhdr{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;border-bottom:1px solid #111;flex-shrink:0}
.lname{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:2px;color:var(--white)}
.lsub{font-size:10px;color:var(--gray);letter-spacing:1px;text-transform:uppercase}
.shdr{display:flex;align-items:center;gap:14px;padding:16px 24px;border-bottom:1px solid #111;flex-shrink:0}
.stitle{font-family:'Bebas Neue',cursive;font-size:26px;letter-spacing:2px;color:var(--white)}
.back{width:36px;height:36px;background:var(--card);border:1px solid #222;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;color:var(--white);transition:all .2s;flex-shrink:0}
.bsm{width:30px;height:30px;font-size:14px}
.gear{width:38px;height:38px;display:flex;align-items:center;justify-content:center;background:var(--card);border-radius:50%;font-size:18px;cursor:pointer;color:var(--gold);border:1px solid rgba(239,184,16,.2);flex-shrink:0}
.badge{padding:4px 10px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:.5px;text-transform:uppercase}
.b-ok{background:rgba(46,204,113,.15);color:var(--green)}
.b-no{background:rgba(231,76,60,.12);color:var(--red)}
.b-rev{background:rgba(239,184,16,.15);color:var(--gold)}
.b-priv{background:rgba(239,184,16,.1);color:var(--gold)}
.b-pub{background:rgba(255,255,255,.08);color:var(--gl)}
.iw{display:flex;flex-direction:column;gap:6px}
.il{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--gray);font-weight:600}
.inp{background:var(--card);border:1px solid #222;border-radius:12px;padding:14px 16px;color:var(--white);font-family:'Montserrat',sans-serif;font-size:14px;outline:none;transition:border-color .2s;width:100%}
.inp:focus{border-color:var(--gold)}
.inp::placeholder{color:#444}
textarea.inp{resize:vertical;min-height:80px}
.bg{width:100%;padding:16px;background:var(--gold);color:var(--black);border:none;border-radius:14px;font-family:'Montserrat',sans-serif;font-weight:900;font-size:14px;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.bg::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.15),transparent 60%)}
.bg:active{transform:scale(.97)}
.bg:hover{box-shadow:0 0 24px var(--gglow)}
.bw{width:100%;padding:16px;background:transparent;color:var(--white);border:1.5px solid var(--white);border-radius:14px;font-family:'Montserrat',sans-serif;font-weight:700;font-size:14px;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;transition:all .2s}
.bgo{width:100%;padding:16px;background:transparent;color:var(--gold);border:1.5px solid var(--gold);border-radius:14px;font-family:'Montserrat',sans-serif;font-weight:700;font-size:14px;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;transition:all .2s}
.bsm2{padding:10px 20px;font-size:12px;width:auto}
.bdanger{width:100%;padding:14px;background:rgba(231,76,60,.08);color:var(--red);border:1px solid rgba(231,76,60,.2);border-radius:12px;font-family:'Montserrat',sans-serif;font-weight:700;font-size:13px;letter-spacing:1px;text-transform:uppercase;cursor:pointer}
.blogout{width:100%;padding:14px;background:rgba(255,255,255,.04);color:var(--white);border:1px solid #222;border-radius:12px;font-family:'Montserrat',sans-serif;font-weight:700;font-size:13px;letter-spacing:1px;text-transform:uppercase;cursor:pointer}
.pill-grp{display:flex;background:var(--card);border-radius:12px;padding:4px;gap:4px}
.pill{flex:1;padding:10px;text-align:center;font-size:12px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(--gray);border-radius:10px;cursor:pointer;transition:all .2s}
.pill.active{background:var(--gold);color:var(--black)}
.togw{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--card);border:1px solid #1e1e1e;border-radius:12px}
.tog{width:48px;height:26px;background:#333;border-radius:13px;position:relative;cursor:pointer;transition:background .3s;flex-shrink:0}
.tog.on{background:var(--gold)}
.tog::after{content:'';position:absolute;width:20px;height:20px;background:var(--white);border-radius:50%;top:3px;left:3px;transition:left .3s;box-shadow:0 2px 4px rgba(0,0,0,.3)}
.tog.on::after{left:25px}
.divider{display:flex;align-items:center;gap:12px}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:#222}
.divider span{color:var(--gray);font-size:11px;letter-spacing:1px;text-transform:uppercase}
.cond{display:none;flex-direction:column;gap:6px}
.cond.show{display:flex}
.srow{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--card);border:1px solid #1e1e1e;border-radius:12px;cursor:pointer;transition:all .2s}
.srow:hover{border-color:#333}
.toast{position:absolute;top:56px;left:20px;right:20px;background:#1a1a1a;border:1px solid rgba(239,184,16,.3);border-radius:12px;padding:12px 16px;z-index:999;transform:translateY(-80px);transition:transform .3s cubic-bezier(.4,0,.2,1);opacity:0}
.toast.show{transform:translateY(0);opacity:1}
.secrow{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.sectitle{font-size:11px;letter-spacing:2.5px;text-transform:uppercase;color:var(--gray);font-weight:700}
.id-box{background:var(--card);border:1px solid rgba(239,184,16,.2);border-radius:14px;padding:14px 16px;display:flex;align-items:center;justify-content:space-between}
.id-val{font-family:'Bebas Neue',cursive;font-size:24px;letter-spacing:4px;color:var(--gold)}
.copy-btn{padding:8px 14px;background:var(--gdim);border:1px solid rgba(239,184,16,.3);border-radius:8px;color:var(--gold);font-size:11px;font-weight:700;cursor:pointer}
.iopt{display:flex;align-items:center;gap:14px;padding:14px;background:var(--card);border:1px solid #1e1e1e;border-radius:14px;cursor:pointer;transition:all .2s}
.iopt:hover{border-color:rgba(239,184,16,.3)}
.iico{width:42px;height:42px;border-radius:12px;background:var(--gdim);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;border:1px solid rgba(239,184,16,.2)}
.modal-ov{position:absolute;inset:0;background:rgba(0,0,0,.88);backdrop-filter:blur(10px);z-index:300;display:flex;flex-direction:column;justify-content:flex-end;padding:16px;opacity:0;pointer-events:none;transition:opacity .3s}
.modal-ov.show{opacity:1;pointer-events:all}
.modal-box{background:#141414;border:1px solid #2a2a2a;border-radius:24px;overflow:hidden;transform:translateY(30px);transition:transform .3s cubic-bezier(.4,0,.2,1);max-height:86vh;display:flex;flex-direction:column}
.modal-ov.show .modal-box{transform:translateY(0)}
.modal-hdr{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid #1e1e1e;flex-shrink:0}
.modal-title{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:2px;color:var(--white)}
.modal-close{width:30px;height:30px;background:#222;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;color:var(--gl);flex-shrink:0}
.modal-body{overflow-y:auto;-webkit-overflow-scrolling:touch;flex:1;padding:16px 20px}
.modal-body::-webkit-scrollbar{display:none}
.sheet-ov{position:absolute;inset:0;background:rgba(0,0,0,.7);z-index:250;opacity:0;pointer-events:none;transition:opacity .25s}
.sheet-ov.show{opacity:1;pointer-events:all}
.sheet-box{position:absolute;bottom:0;left:0;right:0;background:#161616;border-radius:20px 20px 0 0;padding:14px 20px 36px;transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1)}
.sheet-ov.show .sheet-box{transform:translateY(0)}
.sheet-handle{width:36px;height:4px;background:#333;border-radius:2px;margin:0 auto 14px}
.sheet-title{font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--gray);font-weight:700;margin-bottom:12px}
.sheet-btn{padding:15px 0;border-bottom:1px solid #1e1e1e;cursor:pointer;font-size:14px;font-weight:700;color:var(--white);display:block}
.sheet-btn:last-child{border-bottom:none}
.sheet-btn.danger{color:var(--red)}
.lcard{display:flex;align-items:stretch;background:var(--card);border:1px solid rgba(239,184,16,.15);border-radius:16px;margin-bottom:10px;overflow:hidden;transition:all .2s}
.lcard-body{flex:1;display:flex;align-items:center;justify-content:space-between;padding:14px 0 14px 16px;cursor:pointer}
.lcard-dots{width:44px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900;letter-spacing:1px;color:var(--gray);cursor:pointer;border-left:1px solid #1e1e1e;transition:color .2s}
.lcard-dots:hover{color:var(--gold)}
.view-sel{display:flex;gap:6px;padding:10px 20px 0;flex-shrink:0}
.vbtn{padding:6px 14px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;border:1px solid #282828;color:var(--gray);background:transparent;letter-spacing:.5px;transition:all .2s}
.vbtn.active{background:var(--gold);color:var(--black);border-color:var(--gold)}
.forum-feed{padding:12px 16px 16px;display:flex;flex-direction:column;gap:12px;flex-shrink:0}
.fp{background:var(--card);border:1px solid #1e1e1e;border-radius:16px;overflow:hidden}
.fp-hdr{display:flex;align-items:center;gap:10px;padding:12px 14px 8px}
.av{width:34px;height:34px;border-radius:50%;background:#1a1a1a;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;border:1.5px solid #2a2a2a}
.fp-user{font-size:13px;font-weight:700;color:var(--white)}
.fp-reto{font-size:10px;color:var(--gold);font-weight:600}
.fp-time{font-size:10px;color:var(--gray);margin-left:auto;white-space:nowrap}
.fp-media{width:100%;aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;font-size:48px;position:relative;overflow:hidden;background:#050505}
.media-tag{position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,.75);border-radius:6px;padding:3px 8px;font-size:10px;font-weight:700;color:var(--white);letter-spacing:1px;z-index:2}
.fp-foot{padding:10px 14px;display:flex;align-items:center;justify-content:space-between}
.fp-desc{font-size:12px;color:var(--gl);flex:1;line-height:1.4}
.fp-btns{display:flex;gap:8px;align-items:center;flex-shrink:0;margin-left:8px}
.fp-btn{font-size:11px;color:var(--gray);cursor:pointer;font-weight:600;padding:4px 10px;border-radius:8px;border:1px solid #222;background:transparent;transition:all .2s;white-space:nowrap}
.fp-btn:hover{color:var(--white);border-color:#333}
.vbar{margin:0 14px 12px;display:flex;gap:8px}
.vbtn2{flex:1;padding:8px;border-radius:8px;font-size:11px;font-weight:700;text-align:center;cursor:pointer;border:1px solid;letter-spacing:.5px;text-transform:uppercase;transition:all .2s}
.vok{background:rgba(46,204,113,.1);color:var(--green);border-color:rgba(46,204,113,.25)}
.vno{background:rgba(231,76,60,.08);color:var(--red);border-color:rgba(231,76,60,.2)}
#tiktok-wrap{display:none;position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;touch-action:none;background:var(--black);z-index:10;pointer-events:none}
#tiktok-wrap.show{display:block;pointer-events:all}
.tk-slide{position:absolute;width:100%;height:100%;background:var(--black);will-change:transform;transition:transform .35s cubic-bezier(.4,0,.2,1)}
.tk-bg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:90px;background:#050505;overflow:hidden}
.tk-grad{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.9) 0%,rgba(0,0,0,.35) 45%,transparent 70%)}
.tk-info{position:absolute;bottom:30px;left:0;right:56px;padding:0 20px}
.tk-reto{font-family:'Bebas Neue',cursive;font-size:24px;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:5px}
.tk-user{font-size:13px;color:rgba(255,255,255,.75);margin-bottom:10px;font-weight:600}
.tk-side{position:absolute;right:14px;bottom:38px;display:flex;flex-direction:column;align-items:center;gap:18px}
.tk-sb{display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer}
.tk-ico{width:40px;height:40px;background:rgba(255,255,255,.12);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;color:var(--white)}
.tk-tl{font-size:9px;color:rgba(255,255,255,.7);font-weight:700}
.tk-ctr{position:absolute;top:14px;right:16px;background:rgba(0,0,0,.45);padding:4px 10px;border-radius:10px;font-size:11px;color:rgba(255,255,255,.5);font-weight:700}
.tk-back{position:absolute;top:14px;left:14px;width:32px;height:32px;background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.15);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;color:var(--white);z-index:20}
.gtop{padding:14px 20px 0;flex-shrink:0}
.gtitle{font-family:'Bebas Neue',cursive;font-size:28px;letter-spacing:4px;color:var(--white);margin-bottom:12px}
.gtabs{display:flex;background:var(--card);border-radius:13px;padding:4px;gap:4px}
.gtab{flex:1;padding:11px;text-align:center;font-size:12px;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:var(--gray);border-radius:9px;cursor:pointer;transition:all .2s}
.gtab.active{background:var(--gold);color:var(--black)}
.gpanel{padding:14px 18px;display:flex;flex-direction:column;gap:10px;flex-shrink:0}
.cbar{display:flex;gap:8px;margin-bottom:2px}
.cbtn{flex:1;padding:12px 10px;background:var(--card);border:1px solid rgba(239,184,16,.2);border-radius:12px;color:var(--gold);font-family:'Montserrat',sans-serif;font-size:11px;font-weight:800;letter-spacing:.5px;cursor:pointer;transition:all .2s;text-align:center;text-transform:uppercase}
.rc{background:var(--card);border:1px solid #1e1e1e;border-radius:14px;overflow:hidden}
.rc-top{padding:14px 16px 10px;display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
.rc-title{font-size:14px;font-weight:800;color:var(--white);margin-bottom:4px}
.rc-creator{font-size:10px;color:var(--gray)}
.rc-pts{font-family:'Bebas Neue',cursive;font-size:28px;color:var(--gold);line-height:1;flex-shrink:0;text-align:right}
.rc-pts.neg{color:var(--red)}
.rc-pts span{font-family:'Montserrat',sans-serif;font-size:8px;color:var(--gray);display:block;letter-spacing:1px;text-transform:uppercase}
.rc-bot{padding:10px 16px 12px;border-top:1px solid #1a1a1a;display:flex;align-items:center;justify-content:space-between}
.rc-who{font-size:10px;color:var(--gray)}
.rc-who strong{color:var(--gl)}
.cbtn2{padding:8px 16px;background:var(--gold);color:var(--black);border:none;border-radius:8px;font-family:'Montserrat',sans-serif;font-size:11px;font-weight:900;letter-spacing:1px;text-transform:uppercase;cursor:pointer}
.pred-card{background:var(--card);border:1px solid #1e1e1e;border-radius:14px;padding:14px}
.pred-match{font-size:13px;font-weight:800;color:var(--white);margin-bottom:3px}
.pred-q{font-size:11px;color:var(--gray);margin-bottom:10px}
.pred-opts{display:flex;gap:6px}
.pred-opt{flex:1;padding:9px;border-radius:8px;font-size:11px;font-weight:700;text-align:center;cursor:pointer;transition:all .2s;border:1px solid #2a2a2a;color:var(--gray);background:transparent}
.pred-opt.sel{background:var(--gold);color:var(--black);border-color:var(--gold)}
.comp-body{padding:18px 20px;display:flex;flex-direction:column;gap:14px;flex:1}
.reto-hero{background:var(--card);border:1px solid rgba(239,184,16,.2);border-radius:20px;padding:20px;text-align:center}
.rh-name{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:3px;color:var(--white);margin-bottom:4px;line-height:1.1}
.rh-creator{font-size:11px;color:var(--gray);margin-bottom:12px}
.pts-badge{display:inline-flex;align-items:center;gap:6px;background:var(--gdim);border:1px solid rgba(239,184,16,.3);border-radius:20px;padding:7px 14px}
.pts-badge.neg-badge{background:rgba(231,76,60,.08);border-color:rgba(231,76,60,.3)}
.pts-n{font-family:'Bebas Neue',cursive;font-size:26px;color:var(--gold)}
.pts-n.neg{color:var(--red)}
.pts-l{font-size:10px;color:var(--gold);text-transform:uppercase;letter-spacing:1px}
.upload-area{background:var(--card);border:2px dashed #2a2a2a;border-radius:14px;padding:20px;text-align:center;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.upload-area:hover{border-color:rgba(239,184,16,.4)}
.upload-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upload-ico{font-size:32px;margin-bottom:8px;display:block}
.upload-title{font-size:13px;font-weight:700;color:var(--white);margin-bottom:3px}
.upload-sub{font-size:11px;color:var(--gray)}
.up-preview{width:100%;border-radius:10px;overflow:hidden;background:#0a0a0a;position:relative;display:none}
.up-preview img,.up-preview video{width:100%;max-height:180px;object-fit:cover;display:block}
.rm-btn{position:absolute;top:8px;right:8px;width:26px;height:26px;background:rgba(0,0,0,.7);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:var(--white);border:none;z-index:5}
.pend-bar{display:flex;align-items:center;gap:10px;padding:12px 14px;background:rgba(239,184,16,.06);border:1px solid rgba(239,184,16,.15);border-radius:12px}
.pend-dot{width:8px;height:8px;background:var(--gold);border-radius:50%;animation:pulse 1.5s infinite;flex-shrink:0}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.rank-top3{padding:14px 20px 8px;display:flex;justify-content:center;align-items:flex-end;gap:10px;flex-shrink:0}
.pod-item{display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer}
.pod-av{border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid #333;position:relative}
.pod-av.p1{width:62px;height:62px;background:linear-gradient(135deg,#EFB810,#b8860b);border-color:var(--gold);box-shadow:0 0 20px rgba(239,184,16,.4);font-size:22px}
.pod-av.p2{width:50px;height:50px;background:linear-gradient(135deg,#888,#555);font-size:18px}
.pod-av.p3{width:50px;height:50px;background:linear-gradient(135deg,#a0522d,#6b3c1f);font-size:18px}
.crown{position:absolute;top:-14px;font-size:15px;filter:drop-shadow(0 0 6px var(--gold))}
.pod-bar{border-radius:6px 6px 0 0;display:flex;align-items:center;justify-content:center}
.pb1{height:50px;background:linear-gradient(to top,#b8860b,var(--gold));width:64px}
.pb2{height:34px;background:linear-gradient(to top,#444,#888);width:52px}
.pb3{height:22px;background:linear-gradient(to top,#5a3010,#a0522d);width:52px}
.pod-n{font-family:'Bebas Neue',cursive;font-size:15px;color:rgba(0,0,0,.4)}
.rank-list{padding:0 18px 8px;display:flex;flex-direction:column;gap:6px;flex-shrink:0}
.rrow{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--card);border:1px solid #1e1e1e;border-radius:12px;cursor:pointer}
.rn{font-family:'Bebas Neue',cursive;font-size:16px;width:20px;text-align:center;color:var(--gray)}
.r-av{width:34px;height:34px;border-radius:50%;background:#1e1e1e;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.r-pts{font-family:'Bebas Neue',cursive;font-size:18px}
.global-pill{display:inline-flex;padding:4px 10px;background:rgba(239,184,16,.1);border:1px solid rgba(239,184,16,.25);border-radius:8px;font-size:9px;font-weight:800;color:var(--gold);letter-spacing:1.5px;text-transform:uppercase}
.stats-hero{padding:16px 24px;display:flex;flex-direction:column;align-items:center;gap:8px;border-bottom:1px solid #111;flex-shrink:0}
.stats-av{width:72px;height:72px;background:linear-gradient(135deg,#444,#222);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;border:2px solid #333}
.trophy-btn{display:flex;align-items:center;gap:8px;padding:10px 20px;background:linear-gradient(135deg,rgba(239,184,16,.18),rgba(239,184,16,.08));border:1px solid rgba(239,184,16,.35);border-radius:12px;color:var(--gold);font-size:12px;font-weight:800;cursor:pointer;letter-spacing:.5px;transition:all .2s;margin-top:4px}
.sg{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:14px 18px;flex-shrink:0}
.sbox{background:var(--card);border:1px solid #1e1e1e;border-radius:13px;padding:14px;text-align:center}
.sv{font-family:'Bebas Neue',cursive;font-size:30px;color:var(--white);line-height:1;margin-bottom:3px}
.sv.gold{color:var(--gold)}
.slbl{font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--gray)}
.shl{margin:0 18px 10px;background:var(--card);border:1px solid rgba(239,184,16,.12);border-radius:13px;padding:13px}
.shl .lbl{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--gray);margin-bottom:5px}
.shl .val{font-size:13px;font-weight:700;color:var(--white)}
.rsc{margin:0 18px 8px;background:var(--card);border:1px solid #1e1e1e;border-radius:14px;padding:14px 16px}
.rsc-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.rsc-title{font-size:13px;font-weight:800;color:var(--white);flex:1}
.rsc-pts{font-family:'Bebas Neue',cursive;font-size:20px;color:var(--gold)}
.rsc-row{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #1a1a1a}
.rsc-row:last-child{border-bottom:none;padding-bottom:0}
.rsc-lbl{font-size:10px;color:var(--gray);flex:1}
.rsc-val{font-family:'Bebas Neue',cursive;font-size:16px;color:var(--white)}
.rsc-bar-wrap{width:80px;height:4px;background:#1e1e1e;border-radius:2px;overflow:hidden}
.rsc-bar{height:100%;background:var(--gold);border-radius:2px}
.cwrap{flex:1;padding:10px 16px 6px;display:flex;flex-direction:column;gap:8px;min-height:0}
.court{flex:1;background:linear-gradient(180deg,#041404,#081c08 50%,#041404);border:1px solid rgba(255,255,255,.06);border-radius:18px;position:relative;overflow:hidden;min-height:250px}
.court::before{content:'';position:absolute;inset:8px;border:1px solid rgba(255,255,255,.05);border-radius:12px}
.court::after{content:'';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:66px;height:66px;border:1px solid rgba(255,255,255,.04);border-radius:50%}
.crt-line{position:absolute;left:8px;right:8px;top:50%;height:1px;background:rgba(255,255,255,.04)}
.pgrid{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:space-around;padding:16px 10px;gap:6px}
.prow{display:flex;justify-content:center;gap:22px}
.info-btn{position:absolute;top:12px;right:12px;width:26px;height:26px;background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.15);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:13px;color:rgba(255,255,255,.6);z-index:10;user-select:none}
.info-popup{display:none;position:absolute;top:44px;right:12px;width:215px;background:#1c1c1c;border:1px solid rgba(239,184,16,.3);border-radius:14px;padding:14px;z-index:20;box-shadow:0 8px 32px rgba(0,0,0,.6)}
.info-popup.show{display:block}
.ip-title{font-size:13px;font-weight:800;color:var(--gold);margin-bottom:10px}
.ip-row{display:flex;align-items:flex-start;gap:8px;margin-bottom:7px}
.ip-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;margin-top:3px}
.ip-text{font-size:11px;color:var(--gl);line-height:1.35}
.ip-note{font-size:10px;color:var(--gray);margin-top:8px;padding-top:8px;border-top:1px solid #2a2a2a;line-height:1.4}
.pslot{display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;transition:all .2s;user-select:none}
.pslot:hover{transform:scale(1.06)}
.pslot.dragging,.bslot.dragging{opacity:.45}
.pslot.drag-over .pcirc,.bslot.drag-over .bcirc{border-color:var(--gold)!important;box-shadow:0 0 16px rgba(239,184,16,.5)!important}
.pcirc{width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid;position:relative;overflow:hidden;transition:all .2s}
.pcirc.tit{border-color:rgba(239,184,16,.75);box-shadow:0 0 12px rgba(239,184,16,.25)}
.pcirc.emp{background:rgba(255,255,255,.02);border-color:#272727;border-style:dashed}
.pcirc .emoji{font-size:22px;line-height:1}
.pname{font-size:8px;font-weight:700;color:var(--white);text-align:center;max-width:52px;line-height:1.2}
.ppts{font-size:8px;color:var(--gold);font-weight:700}
.bench-box{background:var(--card);border:1px solid #1e1e1e;border-radius:14px;padding:11px 14px}
.bench-lbl{font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--gray);font-weight:700;margin-bottom:9px}
.bench-row{display:flex;gap:10px}
.bslot{display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;user-select:none}
.bcirc{width:38px;height:38px;border-radius:50%;background:rgba(255,255,255,.04);border:1.5px solid rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;transition:all .2s;overflow:hidden}
.bcirc.filled{border-color:rgba(255,255,255,.22);background:rgba(255,255,255,.07)}
.bcirc.emp2{border-style:dashed;border-color:#262626}
.bname{font-size:8px;color:var(--gray);font-weight:600;max-width:42px;text-align:center;line-height:1.2}
.drag-hint{font-size:9px;color:var(--gray);text-align:center;padding:4px 0;letter-spacing:.5px}
.pick-ov{position:absolute;inset:0;background:rgba(0,0,0,.88);backdrop-filter:blur(8px);z-index:200;display:flex;flex-direction:column;justify-content:flex-end;padding:16px;opacity:0;pointer-events:none;transition:opacity .3s}
.pick-ov.show{opacity:1;pointer-events:all}
.pick-box{background:var(--card2);border:1px solid rgba(239,184,16,.22);border-radius:24px;padding:20px;transform:translateY(30px);transition:transform .3s cubic-bezier(.4,0,.2,1)}
.pick-ov.show .pick-box{transform:translateY(0)}
.pick-title{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:2px;color:var(--white);margin-bottom:2px}
.pick-slot{font-size:11px;color:var(--gold);font-weight:700;margin-bottom:12px}
.ulist{display:flex;flex-direction:column;gap:7px;margin-bottom:14px;max-height:220px;overflow-y:auto;-webkit-overflow-scrolling:touch}
.ulist::-webkit-scrollbar{display:none}
.upick{display:flex;align-items:center;gap:12px;padding:10px 13px;background:rgba(255,255,255,.03);border:1px solid #1e1e1e;border-radius:12px;cursor:pointer;transition:all .2s}
.upick:hover,.upick.sel{border-color:var(--gold);background:var(--gdim)}
.u-av{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;border:1.5px solid #2a2a2a;font-family:'Bebas Neue',cursive;font-size:12px}
.upick-name{font-size:13px;font-weight:700;color:var(--white);flex:1}
.upick-pts{font-family:'Bebas Neue',cursive;font-size:18px;color:var(--gold)}
.pick-acts{display:flex;gap:10px}
.pick-cancel{flex:1;padding:12px;background:transparent;border:1px solid #333;border-radius:12px;color:var(--gray);font-family:'Montserrat',sans-serif;font-weight:700;font-size:12px;cursor:pointer;text-transform:uppercase;letter-spacing:1px}
.trophy-prev-wrap{width:140px;height:140px;background:linear-gradient(135deg,#1a1200,#0a0800);border:1px solid rgba(239,184,16,.3);border-radius:20px;margin:0 auto 14px;display:flex;align-items:center;justify-content:center;font-size:70px;position:relative}
.trophy-name-prev{font-family:'Bebas Neue',cursive;font-size:18px;letter-spacing:2px;color:var(--gold);margin-bottom:4px}
.trophy-season-prev{font-size:10px;color:var(--gray);letter-spacing:2px;text-transform:uppercase}
.t-prod{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid #1e1e1e;border-radius:16px;padding:14px;cursor:pointer;transition:all .2s;position:relative;margin-bottom:10px}
.t-prod.sel{border-color:var(--gold);background:rgba(239,184,16,.05)}
.t-prod .chk{position:absolute;top:12px;right:12px;width:20px;height:20px;border-radius:50%;background:var(--gold);display:none;align-items:center;justify-content:center;font-size:11px;color:var(--black)}
.t-prod.sel .chk{display:flex}
.t-img{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,#1a1200,#0a0800);display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0;border:1px solid rgba(239,184,16,.2)}
.t-name{font-size:13px;font-weight:800;color:var(--white);margin-bottom:2px}
.t-desc{font-size:11px;color:var(--gray);line-height:1.3}
.t-price{font-family:'Bebas Neue',cursive;font-size:20px;color:var(--gold);margin-top:4px}
.instr-row{display:flex;gap:12px;align-items:flex-start;margin-bottom:14px}
.instr-num{width:28px;height:28px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',cursive;font-size:16px;color:var(--black);flex-shrink:0;margin-top:2px}
.instr-text strong{color:var(--white);font-size:13px;display:block;margin-bottom:3px}
.instr-text p{font-size:12px;color:var(--gl);line-height:1.45}
.instr-div{height:1px;background:#1e1e1e;margin:0 0 14px}
.q-size-grp{display:flex;gap:6px}
.q-size-btn{flex:1;padding:11px 6px;text-align:center;font-family:'Bebas Neue',cursive;font-size:18px;color:var(--gray);background:var(--card);border:1px solid #222;border-radius:10px;cursor:pointer;transition:all .2s;letter-spacing:1px}
.q-size-btn.active{background:var(--gold);color:var(--black);border-color:var(--gold)}
.info-inline{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;border:1px solid rgba(239,184,16,.4);color:var(--gold);font-size:10px;cursor:pointer;flex-shrink:0;margin-left:5px}
.lang-grp{display:flex;gap:6px}
.lang-btn{padding:7px 14px;background:var(--card);border:1px solid #222;border-radius:8px;color:var(--gl);font-family:'Montserrat',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s}
.lang-btn.active{background:var(--gold);color:var(--black);border-color:var(--gold)}
.about-block{background:var(--card);border-radius:14px;padding:16px;margin-bottom:12px}
.about-block-title{font-size:11px;font-weight:800;color:var(--gold);letter-spacing:1px;margin-bottom:8px}
.about-block-body{font-size:12px;color:var(--gl);line-height:1.6}
</style>
</head>
<body>
<div class="phone" id="phone">
<div class="sb"><span class="time">9:41</span><div class="icons"><span>‚óè‚óè‚óè‚óè</span><span>WiFi</span><span>üîã</span></div></div>
<div class="toast" id="toast"><span id="t-msg" style="font-size:12px;font-weight:700;color:var(--white)">‚Äî</span></div>

<!-- SPLASH -->
<!-- LOGIN -->
<div class="screen active full-scroll" id="s-login">
  <div style="flex:1;display:flex;flex-direction:column;padding:32px 28px;min-height:580px">
    <div style="display:flex;flex-direction:column;align-items:center;margin-bottom:40px">
      <span style="font-size:52px;filter:drop-shadow(0 0 14px var(--gglow));margin-bottom:8px;display:block">üêê</span>
      <div style="font-family:'Bebas Neue',cursive;font-size:42px;letter-spacing:5px;color:var(--white);line-height:1">FANTASY <span style="color:var(--gold)">GOAT</span></div>
      <div id="t-tagline" style="font-size:9px;letter-spacing:6px;color:var(--gray);text-transform:uppercase;margin-top:6px">La Liga de los Elegidos</div>
    </div>
    <div style="display:flex;flex-direction:column;gap:16px;margin-bottom:24px">
      <div class="iw"><label class="il">Email</label><input class="inp" id="inp-email" type="email" placeholder="tu@email.com"></div>
      <div class="iw"><label class="il">Contrase√±a</label><input class="inp" id="inp-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"><div style="text-align:right;font-size:11px;color:var(--gold);font-weight:600;cursor:pointer;margin-top:4px">¬øOlvidaste tu contrase√±a?</div></div>
      <button class="bg" onclick="fbSignIn()">Iniciar sesi√≥n</button>
      <button class="bw" onclick="fbSignUp()">Crear cuenta</button>
    </div>
    <div style="margin-top:auto;display:flex;flex-direction:column;gap:12px">
      <div class="divider"><span>o contin√∫a con</span></div>
      <div style="display:flex;align-items:center;justify-content:center;gap:10px;padding:13px;background:var(--card);border:1px solid #222;border-radius:12px;color:var(--white);font-size:13px;font-weight:600;cursor:pointer" onclick="fbGoogle()"><b>G</b> Iniciar sesi√≥n con Google</div>
      <div style="display:flex;align-items:center;justify-content:center;gap:10px;padding:13px;background:var(--card);border:1px solid #222;border-radius:12px;color:var(--white);font-size:13px;font-weight:600;cursor:pointer">Iniciar sesi√≥n con Apple</div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div class="screen" id="s-dashboard">
  <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 24px;border-bottom:1px solid #111;flex-shrink:0">
    <div style="width:38px"></div>
    <div style="display:flex;align-items:center;gap:8px"><span style="font-size:20px">üêê</span><div style="font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:2px;color:var(--white)">FANTASY <span style="color:var(--gold)">GOAT</span></div></div>
    <div class="gear" onclick="go('s-settings')">‚öôÔ∏è</div>
  </div>
  <div style="padding:10px 20px 0;display:flex;justify-content:flex-end;flex-shrink:0">
    <button onclick="openModal('m-instr')" style="padding:6px 14px;background:transparent;border:1px solid #2a2a2a;border-radius:20px;color:var(--gl);font-family:'Montserrat',sans-serif;font-size:11px;font-weight:700;cursor:pointer;letter-spacing:.5px">Instrucciones</button>
  </div>
  <div style="padding:10px 20px;display:flex;flex-direction:column;gap:10px">
    <button class="bg" onclick="go('s-crear-liga')">+ Crear Liga</button>
    <button class="bgo" onclick="go('s-join')">Unirse a una Liga</button>
  </div>
  <div style="padding:0 20px 24px">
    <div class="secrow"><span class="sectitle">Mis Ligas</span><span style="font-size:11px;color:var(--gold);font-weight:700;cursor:pointer">Ver todas</span></div>
    <div id="leagues-list">
      <div style="text-align:center;padding:40px 20px;color:var(--gray)">
        <div style="font-size:36px;margin-bottom:12px">üèÜ</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">A√∫n no est√°s en ninguna liga</div>
        <div style="font-size:11px;line-height:1.5">Crea una liga o √∫nete con un ID</div>
      </div>
    </div>
  </div>
</div>

<!-- JOIN -->
<div class="screen full-scroll" id="s-join">
  <div class="shdr"><div class="back" onclick="go('s-dashboard')">‚Äπ</div><div class="stitle">Unirse a Liga</div></div>
  <div style="padding:24px;display:flex;flex-direction:column;gap:16px;flex:1">
    <div class="iw"><label class="il">ID de Liga</label><input class="inp" id="join-id" type="text" placeholder="GOAT-7X4K2"></div>
    <div class="iw"><label class="il">Contrase√±a (si es privada)</label><input class="inp" id="join-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    <button class="bg" onclick="unirseALiga()">Buscar y Unirse</button>
    <button class="bw" onclick="go('s-dashboard')">Cancelar</button>
  </div>
</div>

<!-- SETTINGS -->
<div class="screen full-scroll" id="s-settings">
  <div class="shdr"><div class="back" onclick="goBack()">‚Äπ</div><div class="stitle">Ajustes</div></div>
  <div style="display:flex;align-items:center;gap:14px;padding:18px 20px;border-bottom:1px solid #111;flex-shrink:0">
    <div style="position:relative"><div style="width:70px;height:70px;background:linear-gradient(135deg,var(--gold),#b8860b);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;border:2px solid rgba(239,184,16,.3)">üòé</div><div style="position:absolute;bottom:0;right:0;width:22px;height:22px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;cursor:pointer">‚úèÔ∏è</div></div>
    <div><div id="settings-name" style="font-size:18px;font-weight:800;color:var(--white)">‚Äî</div><div id="settings-email" style="font-size:12px;color:var(--gray);margin-top:2px">‚Äî</div></div>
  </div>
  <div style="padding:18px 20px;display:flex;flex-direction:column;gap:10px;flex:1">
    <div style="font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--gray);font-weight:700">Preferencias</div>
    <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--card);border:1px solid #1e1e1e;border-radius:12px">
      <span style="font-size:14px;color:var(--white);font-weight:600">Idioma</span>
      <div class="lang-grp">
        <button class="lang-btn active" id="lb-es" onclick="setLang('es')">ES</button>
        <button class="lang-btn" id="lb-en" onclick="setLang('en')">EN</button>
        <button class="lang-btn" id="lb-fr" onclick="setLang('fr')">FR</button>
      </div>
    </div>
    <div class="togw"><span style="font-size:14px;color:var(--white);font-weight:600">Notificaciones</span><div class="tog on" onclick="this.classList.toggle('on')"></div></div>
    <div style="font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--gray);font-weight:700;margin-top:4px">Soporte</div>
    <div class="srow" onclick="openModal('m-feedback')"><span style="font-size:14px;color:var(--white);font-weight:600">¬øTienes alg√∫n comentario?</span><span style="color:#444;font-size:16px">‚Ä∫</span></div>
    <div class="srow" onclick="openModal('m-about')"><span style="font-size:14px;color:var(--white);font-weight:600">Sobre Fantasy GOAT</span><span style="color:#444;font-size:16px">‚Ä∫</span></div>
    <div style="font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--gray);font-weight:700;margin-top:4px">Cuenta</div>
    <button class="blogout" onclick="fbSignOut()">Cerrar sesi√≥n</button>
    <button class="bdanger" onclick="toast('Acci√≥n irreversible')">Eliminar cuenta</button>
  </div>
</div>

<!-- CREAR LIGA -->
<div class="screen full-scroll" id="s-crear-liga">
  <div class="shdr"><div class="back" onclick="go('s-dashboard')">‚Äπ</div><div class="stitle">Crear Liga</div></div>
  <div style="padding:24px;display:flex;flex-direction:column;gap:18px;flex:1">
    <div class="iw"><label class="il">Nombre de la liga</label><input class="inp" id="liga-nombre" type="text" placeholder="Los Invencibles..."></div>
    <div class="iw"><label class="il">Tipo</label>
      <div class="pill-grp"><div class="pill active" id="tipo-priv" onclick="setTipo('priv',this)">Privada</div><div class="pill" id="tipo-pub" onclick="setTipo('pub',this)">P√∫blica</div></div>
    </div>
    <div class="cond show" id="f-pass"><label class="il">Contrase√±a</label><input class="inp" id="liga-pass" type="password" placeholder="M√≠nimo 6 caracteres..."></div>
    <div class="cond" id="f-id"><label class="il">ID de liga (opcional)</label><input class="inp" id="liga-custom-id" type="text" placeholder="GOAT2024..."></div>
    <div class="iw"><label class="il">Periodicidad</label>
      <div class="pill-grp"><div class="pill active" id="period-sem" onclick="setPeriod(this)">Semanal</div><div class="pill" id="period-men" onclick="setPeriod(this)">Mensual</div></div>
    </div>
    <div class="iw">
      <div style="display:flex;align-items:center;gap:4px"><label class="il">Tama√±o del equipo</label><span class="info-inline" onclick="openModal('m-qinfo')">i</span></div>
      <div class="q-size-grp">
        <div class="q-size-btn" onclick="setQSize(2,this)">2</div>
        <div class="q-size-btn" onclick="setQSize(3,this)">3</div>
        <div class="q-size-btn" onclick="setQSize(4,this)">4</div>
        <div class="q-size-btn active" onclick="setQSize(5,this)">5</div>
      </div>
      <div style="font-size:10px;color:var(--gray);margin-top:2px">N√∫mero de titulares en el campo</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="iw">
        <div style="display:flex;align-items:center;gap:4px"><label class="il">Pts titular / periodo</label><span class="info-inline" onclick="openModal('m-qinfo')">i</span></div>
        <input class="inp" type="number" id="starter-pts" value="10" min="0" max="999">
      </div>
      <div class="iw">
        <div style="display:flex;align-items:center;gap:4px"><label class="il">Pts suplente / periodo</label><span class="info-inline" onclick="openModal('m-qinfo')">i</span></div>
        <input class="inp" type="number" id="bench-pts" value="4" min="0" max="999">
      </div>
    </div>
    <button class="bg" onclick="crearLiga()">Crear Liga</button>
  </div>
</div>

<!-- INVITE -->
<div class="screen full-scroll" id="s-invite">
  <div class="shdr"><div class="back" onclick="go('s-crear-liga')">‚Äπ</div><div class="stitle">Invitar Amigos</div></div>
  <div style="padding:20px;display:flex;flex-direction:column;gap:14px;flex:1">
    <div style="text-align:center;padding:10px 0"><div style="font-size:56px;margin-bottom:10px">üéâ</div><div style="font-family:'Bebas Neue',cursive;font-size:26px;letter-spacing:3px;color:var(--white);margin-bottom:4px">¬°Liga Creada!</div><div style="font-size:12px;color:var(--gray)">Invita a tus amigos y empieza a competir</div></div>
    <div class="id-box"><div><div style="font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--gray);margin-bottom:3px">ID de Liga</div><div class="id-val" id="invite-id-display">‚Äî</div></div><div class="copy-btn" onclick="copiarId()">Copiar</div></div>
    <div class="iopt" onclick="compartirWhatsApp()"><div class="iico">üì±</div><div><div style="font-size:14px;font-weight:700;color:var(--white)">Compartir por WhatsApp</div><div style="font-size:11px;color:var(--gray);margin-top:2px">Env√≠a el enlace directo</div></div></div>
    <div class="iopt" onclick="copiarEnlace()"><div class="iico">üîó</div><div><div style="font-size:14px;font-weight:700;color:var(--white)">Copiar enlace</div><div id="invite-url-display" style="font-size:11px;color:var(--gray);margin-top:2px">‚Äî</div></div></div>
    <button class="bg" onclick="go('s-home')">Continuar</button>
  </div>
</div>

<!-- HOME -->
<div class="screen" id="s-home">
  <div class="lhdr"><div><div style="display:flex;align-items:center;gap:8px"><div class="back bsm" onclick="go('s-dashboard')">‚Äπ</div><div class="lname">Los Intocables</div></div><div class="lsub" style="padding-left:38px">8 jugadores ¬∑ Semanal</div></div><span class="badge b-priv">Privada</span></div>
  <div class="view-sel">
    <button class="vbtn active" id="vb-list" onclick="setView('list')">Lista</button>
    <button class="vbtn" id="vb-feed" onclick="setView('feed')">Feed</button>
  </div>
  <div class="screen-scroll" id="home-scroll">
    <div id="list-view"><div class="forum-feed" id="forum-feed"></div></div>
  </div>
  <div id="tiktok-wrap"></div>
  <div class="bnav">
    <div class="ni active" onclick="nav('s-home',0)"><span class="icon">üè†</span><span class="lbl">Foro</span></div>
    <div class="ni" onclick="nav('s-ranking',1)"><span class="icon">üèÜ</span><span class="lbl">Ranking</span></div>
    <div class="nc" onclick="nav('s-goat',2)">üêê</div>
    <div class="ni" onclick="nav('s-equipo',3)"><span class="icon">‚≠ê</span><span class="lbl">Equipo</span></div>
    <div class="ni" onclick="nav('s-stats',4)"><span class="icon">üë§</span><span class="lbl">Perfil</span></div>
  </div>
</div>

<!-- GOAT / RETOS -->
<div class="screen" id="s-goat">
  <div class="lhdr"><div><div style="display:flex;align-items:center;gap:8px"><div class="back bsm" onclick="go('s-dashboard')">‚Äπ</div><div class="lname" id="goat-liga-name">‚Äî</div></div></div><span class="badge b-priv" id="goat-liga-badge">‚Äî</span></div>
  <div class="gtop" style="flex-shrink:0">
    <div class="gtitle">RETOS</div>
    <div class="gtabs">
      <div class="gtab active" id="gtab-r" onclick="switchTab('r')">Retos</div>
      <div class="gtab" id="gtab-v" onclick="switchTab('v')" style="display:none">Validar</div>
      <div class="gtab" id="gtab-p" onclick="switchTab('p')">Predicciones</div>
    </div>
  </div>
  <div class="screen-scroll">
    <div class="gpanel" id="gpanel-r">
      <div class="cbar"><div class="cbtn" onclick="go('s-crear-reto')">+ Crear Reto</div><div class="cbtn" onclick="toast('Pr√≥ximamente')">+ Predicci√≥n</div></div>
      <div class="secrow"><span class="sectitle">Retos de la liga</span><span class="badge b-rev" id="retos-pending-badge" style="display:none">0 pendientes</span></div>
      <div id="retos-list">
        <div style="text-align:center;padding:40px 20px;color:var(--gray)">
          <div style="font-size:36px;margin-bottom:12px">üéØ</div>
          <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin retos todav√≠a</div>
          <div style="font-size:11px;line-height:1.5">Crea el primer reto de la liga</div>
        </div>
      </div>
    </div>
    <div class="gpanel" id="gpanel-v" style="display:none">
      <div class="secrow"><span class="sectitle">Completados pendientes</span><span class="badge b-gold" id="completados-badge" style="display:none">0</span></div>
      <div id="completados-list">
        <div style="text-align:center;padding:40px 20px;color:var(--gray)">
          <div style="font-size:36px;margin-bottom:12px">‚úÖ</div>
          <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin completados pendientes</div>
        </div>
      </div>
    </div>
    <div class="gpanel" id="gpanel-p" style="display:none">
      <div class="cbar"><div class="cbtn" style="flex:1" onclick="toast('Pr√≥ximamente')">+ Predicci√≥n</div></div>
      <div style="text-align:center;padding:40px 20px;color:var(--gray)">
        <div style="font-size:36px;margin-bottom:12px">üîÆ</div>
        <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Predicciones pr√≥ximamente</div>
      </div>
    </div>
  </div>
  <div class="bnav"><div class="ni" onclick="nav('s-home',0)"><span class="icon">üè†</span><span class="lbl">Foro</span></div><div class="ni" onclick="nav('s-ranking',1)"><span class="icon">üèÜ</span><span class="lbl">Ranking</span></div><div class="nc active" onclick="nav('s-goat',2)">üêê</div><div class="ni" onclick="nav('s-equipo',3)"><span class="icon">‚≠ê</span><span class="lbl">Equipo</span></div><div class="ni" onclick="nav('s-stats',4)"><span class="icon">üë§</span><span class="lbl">Perfil</span></div></div>
</div>

<!-- CREAR RETO -->
<div class="screen full-scroll" id="s-crear-reto">
  <div class="shdr"><div class="back" onclick="go('s-goat')">‚Äπ</div><div class="stitle">Crear Reto</div></div>
  <div style="padding:24px;display:flex;flex-direction:column;gap:20px;flex:1">
    <div class="iw"><label class="il">T√≠tulo del reto</label><input class="inp" id="reto-titulo" type="text" placeholder="Ej: Hacer una ruta de senderismo..."></div>
    <div class="iw"><label class="il">Puntos (positivos o negativos)</label><input class="inp" id="reto-pts" type="number" placeholder="Ej: 300 o -100"><div style="font-size:10px;color:var(--gray);margin-top:4px">Usa puntos negativos para penalizaciones</div></div>
    <div class="iw"><label class="il">Descripci√≥n (opcional)</label><input class="inp" id="reto-desc" type="text" placeholder="A√±ade detalles..."></div>
    <button class="bg" onclick="publicarReto()">Publicar Reto</button>
  </div>
</div>

<!-- COMPLETAR -->
<div class="screen full-scroll" id="s-completar">
  <div class="shdr"><div class="back" onclick="go('s-goat')">‚Äπ</div><div class="stitle">Completar Reto</div></div>
  <div class="comp-body">
    <div class="reto-hero">
      <div class="rh-name" id="comp-name">NOMBRE</div>
      <div class="rh-creator">Creado por <span id="comp-creator" style="color:var(--gold);font-weight:700"></span></div>
      <div class="pts-badge" id="comp-pts-badge"><span class="pts-n" id="comp-pts">500</span><span class="pts-l">pts</span></div>
    </div>
    <div class="iw"><label class="il">Imagen (opcional)</label><div class="upload-area" id="img-area"><input type="file" accept="image/*" multiple id="img-input" onchange="handleImg(event)"><span class="upload-ico">üñºÔ∏è</span><div class="upload-title">Toca para subir foto</div><div class="upload-sub">PNG ¬∑ JPG ¬∑ HEIC</div></div><div class="up-preview" id="img-prev"><img id="img-el" src="" style="border-radius:10px"><button class="rm-btn" onclick="clearMedia('img')">‚úï</button></div></div>
    <div class="iw"><label class="il">V√≠deo corto (m√°x. 30 seg ¬∑ 20 MB)</label><div class="upload-area" id="vid-area"><input type="file" accept="video/*" id="vid-input" onchange="handleVid(event)"><span class="upload-ico">üé¨</span><div class="upload-title">Toca para subir v√≠deo</div><div class="upload-sub">MP4 ¬∑ MOV ¬∑ m√°x. 30s</div></div><div class="up-preview" id="vid-prev"><video id="vid-el" controls playsinline style="border-radius:10px"></video><button class="rm-btn" onclick="clearMedia('vid')">‚úï</button></div></div>
    <div class="iw"><label class="il">Justificaci√≥n (opcional)</label><textarea class="inp" id="comp-text"></textarea></div>
    <button class="bg" onclick="submitReto()">Completar Reto</button>
    <button class="bw" style="padding:12px;font-size:12px" onclick="submitRetoSin()">Completar sin prueba</button>
    <div class="pend-bar"><div class="pend-dot"></div><span style="font-size:12px;color:var(--gold);font-weight:600">Pendiente de aprobaci√≥n del √°rbitro</span></div>
  </div>
</div>

<!-- RANKING -->
<div class="screen" id="s-ranking">
  <div class="lhdr"><div><div style="display:flex;align-items:center;gap:8px"><div class="back bsm" onclick="go('s-dashboard')">‚Äπ</div><div class="lname">Los Intocables</div></div></div><span class="badge b-priv">Privada</span></div>
  <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 20px;border-bottom:1px solid #111;flex-shrink:0">
    <div style="font-family:'Bebas Neue',cursive;font-size:24px;letter-spacing:3px;color:var(--white)">RANKING</div>
    <select id="rank-filter" onchange="renderRanking()" style="background:var(--card);border:1px solid #222;border-radius:8px;padding:7px 12px;color:var(--white);font-size:11px;font-weight:700;cursor:pointer;outline:none">
      <option value="global">GLOBAL</option>
      <option value="feb" selected>Febrero 2026</option>
      <option value="ene">Enero 2026</option>
      <option value="dic">Diciembre 2025</option>
      <option value="nov">Noviembre 2025</option>
    </select>
  </div>
  <div class="screen-scroll">
    <div id="rank-top3" class="rank-top3"></div>
    <div id="rank-global-label" style="display:none;padding:4px 20px 4px;flex-shrink:0"><span class="global-pill">Acumulado total ¬∑ todos los meses</span></div>
    <div id="rank-list" class="rank-list"></div>
  </div>
  <div class="bnav"><div class="ni" onclick="nav('s-home',0)"><span class="icon">üè†</span><span class="lbl">Foro</span></div><div class="ni active" onclick="nav('s-ranking',1)"><span class="icon">üèÜ</span><span class="lbl">Ranking</span></div><div class="nc" onclick="nav('s-goat',2)">üêê</div><div class="ni" onclick="nav('s-equipo',3)"><span class="icon">‚≠ê</span><span class="lbl">Equipo</span></div><div class="ni" onclick="nav('s-stats',4)"><span class="icon">üë§</span><span class="lbl">Perfil</span></div></div>
</div>

<!-- PERFIL -->
<div class="screen" id="s-stats">
  <div class="lhdr"><div style="display:flex;align-items:center;gap:8px"><div class="back bsm" onclick="goBack()">‚Äπ</div><div class="lname">Perfil</div></div><div class="gear" onclick="go('s-settings')">‚öôÔ∏è</div></div>
  <div class="stats-hero">
    <div class="stats-av">üòà</div>
    <div id="prof-name" style="font-size:20px;font-weight:800;color:var(--white);margin-top:4px">‚Äî</div>
    <div id="prof-email" style="font-size:12px;color:var(--gray);margin-top:2px">‚Äî</div>
    <button class="trophy-btn" onclick="openModal('m-trophy')">Solicitar Trofeo</button>
  </div>
  <div class="screen-scroll">
  <div class="sg">
    <div class="sbox"><div class="sv gold" id="prof-pts">0</div><div class="slbl">Puntos totales</div></div>
    <div class="sbox"><div class="sv" id="prof-retos">0</div><div class="slbl">Retos completados</div></div>
    <div class="sbox"><div class="sv" id="prof-ligas">0</div><div class="slbl">Ligas activas</div></div>
    <div class="sbox"><div class="sv" id="prof-aprov" style="color:var(--green)">‚Äî</div><div class="slbl">Tasa aprobaci√≥n</div></div>
  </div>
  <div id="prof-historial">
    <div style="text-align:center;padding:32px 20px;color:var(--gray)">
      <div style="font-size:32px;margin-bottom:10px">üìã</div>
      <div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin historial todav√≠a</div>
      <div style="font-size:11px;line-height:1.5">Completa retos para ver tus estad√≠sticas aqu√≠</div>
    </div>
  </div>
  <div style="padding:14px 18px 8px"><button class="bgo" onclick="nav('s-equipo',3)">Ver Equipo</button></div>
  </div>
  <div class="bnav"><div class="ni" onclick="nav('s-home',0)"><span class="icon">üè†</span><span class="lbl">Foro</span></div><div class="ni" onclick="nav('s-ranking',1)"><span class="icon">üèÜ</span><span class="lbl">Ranking</span></div><div class="nc" onclick="nav('s-goat',2)">üêê</div><div class="ni" onclick="nav('s-equipo',3)"><span class="icon">‚≠ê</span><span class="lbl">Equipo</span></div><div class="ni active" onclick="nav('s-stats',4)"><span class="icon">üë§</span><span class="lbl">Perfil</span></div></div>
</div>

<!-- EQUIPO -->
<div class="screen" id="s-equipo">
  <div class="lhdr"><div><div style="display:flex;align-items:center;gap:8px"><div class="back bsm" onclick="go('s-dashboard')">‚Äπ</div><div class="lname">Mi Equipo</div></div><div class="lsub" style="padding-left:38px">Los Intocables ¬∑ Semana 7</div></div><button class="bg bsm2" onclick="toast('Equipo guardado')">Guardar</button></div>
  <div class="cwrap">
    <div class="court" id="court-el">
      <div class="crt-line"></div>
      <div class="info-btn" onclick="toggleInfo(event)">‚ìò</div>
      <div class="info-popup" id="info-popup">
        <div class="ip-title">Puntos por alineaci√≥n</div>
        <div class="ip-row"><div class="ip-dot" style="background:var(--gold)"></div><div class="ip-text"><strong style="color:var(--white)">Titulares:</strong> <span id="ip-starter-pts">+10</span> pts / periodo</div></div>
        <div class="ip-row"><div class="ip-dot" style="background:var(--gray)"></div><div class="ip-text"><strong style="color:var(--white)">Banquillo:</strong> <span id="ip-bench-pts">+4</span> pts / periodo</div></div>
        <div class="ip-note">Se recalcula cada semana / mes seg√∫n la periodicidad de la liga</div>
      </div>
      <div class="pgrid" id="court-grid"></div>
    </div>
    <div class="drag-hint">Pulsa para seleccionar ¬∑ arrastra para intercambiar</div>
    <div class="bench-box"><div class="bench-lbl">Banquillo</div><div class="bench-row" id="bench-row"></div></div>
  </div>
  <div class="pick-ov" id="picker" onclick="closePicker()">
    <div class="pick-box" onclick="event.stopPropagation()">
      <div class="pick-title">Seleccionar miembro</div>
      <div class="pick-slot" id="pick-slot"></div>
      <div class="ulist">
        <div class="upick" onclick="selUser(this,'CarlosGOAT','4.750','üòà')"><div class="u-av" style="background:linear-gradient(135deg,#EFB810,#b8860b);color:#000">CG</div><div class="upick-name">CarlosGOAT</div><div class="upick-pts">4.750</div></div>
        <div class="upick" onclick="selUser(this,'MikelFC','3.240','üòä')"><div class="u-av" style="background:#242424;color:#fff">MK</div><div class="upick-name">MikelFC</div><div class="upick-pts">3.240</div></div>
        <div class="upick" onclick="selUser(this,'LauraElite','2.890','üë©')"><div class="u-av" style="background:#1e1e1e;color:#fff">LE</div><div class="upick-name">LauraElite</div><div class="upick-pts">2.890</div></div>
        <div class="upick" onclick="selUser(this,'PedroM√°s','2.100','üßî')"><div class="u-av" style="background:#191919;color:#fff">PM</div><div class="upick-name">PedroM√°s</div><div class="upick-pts">2.100</div></div>
        <div class="upick" onclick="selUser(this,'LeonardoK','1.850','ü¶Å')"><div class="u-av" style="background:#141414;color:#fff">LK</div><div class="upick-name">LeonardoK</div><div class="upick-pts">1.850</div></div>
        <div class="upick" onclick="selUser(this,'WolfPackX','1.640','üê∫')"><div class="u-av" style="background:#111;color:#fff">WP</div><div class="upick-name">WolfPackX</div><div class="upick-pts">1.640</div></div>
        <div class="upick" onclick="selUser(this,'EagleRise','1.200','ü¶Ö')"><div class="u-av" style="background:#0e0e0e;color:#fff">ER</div><div class="upick-name">EagleRise</div><div class="upick-pts">1.200</div></div>
        <div class="upick" onclick="selUser(this,'FoxTricky','980','ü¶ä')"><div class="u-av" style="background:#0a0a0a;color:#fff">FT</div><div class="upick-name">FoxTricky</div><div class="upick-pts">980</div></div>
      </div>
      <div class="pick-acts"><button class="pick-cancel" onclick="closePicker()">Cancelar</button><button class="bg" style="flex:2" onclick="confirmPick()">Confirmar</button></div>
    </div>
  </div>
  <div class="bnav"><div class="ni" onclick="nav('s-home',0)"><span class="icon">üè†</span><span class="lbl">Foro</span></div><div class="ni" onclick="nav('s-ranking',1)"><span class="icon">üèÜ</span><span class="lbl">Ranking</span></div><div class="nc" onclick="nav('s-goat',2)">üêê</div><div class="ni active" onclick="nav('s-equipo',3)"><span class="icon">‚≠ê</span><span class="lbl">Equipo</span></div><div class="ni" onclick="nav('s-stats',4)"><span class="icon">üë§</span><span class="lbl">Perfil</span></div></div>
</div>

<!-- MODAL INSTRUCCIONES -->
<div class="modal-ov" id="m-instr" onclick="closeModal('m-instr')">
  <div class="modal-box" onclick="event.stopPropagation()" style="max-height:88vh">
    <div class="modal-hdr"><div class="modal-title">C√≥mo jugar</div><div class="modal-close" onclick="closeModal('m-instr')">‚úï</div></div>
    <div class="modal-body">
      <p style="font-size:12px;color:var(--gray);margin-bottom:16px;line-height:1.5">Fantasy GOAT es una liga de retos de la vida real entre amigos. Completa retos, sube pruebas, gana puntos.</p>
      <div class="instr-row"><div class="instr-num">1</div><div class="instr-text"><strong>Crea o √∫nete a una liga</strong><p>Crea tu propia liga privada o p√∫blica e invita a tus amigos con el ID o enlace.</p></div></div>
      <div class="instr-div"></div>
      <div class="instr-row"><div class="instr-num">2</div><div class="instr-text"><strong>Publica retos</strong><p>Cualquier miembro puede proponer un reto. Puedes poner puntos negativos como penalizaci√≥n.</p></div></div>
      <div class="instr-div"></div>
      <div class="instr-row"><div class="instr-num">3</div><div class="instr-text"><strong>Completa y sube prueba</strong><p>Pulsa "Completar" y sube foto, v√≠deo (m√°x. 30 seg) o justificaci√≥n escrita.</p></div></div>
      <div class="instr-div"></div>
      <div class="instr-row"><div class="instr-num">4</div><div class="instr-text"><strong>El √°rbitro valida</strong><p>El admin aprueba o rechaza. Si se aprueba, los puntos se suman al marcador.</p></div></div>
      <div class="instr-div"></div>
      <div class="instr-row"><div class="instr-num">5</div><div class="instr-text"><strong>Equipo</strong><p>Elige tu equipo de titulares m√°s suplentes. Los titulares suman m√°s puntos por periodo.</p></div></div>
      <div class="instr-div"></div>
      <div class="instr-row"><div class="instr-num">6</div><div class="instr-text"><strong>Ranking</strong><p>Consulta el ranking mensual o el GLOBAL acumulado. El que m√°s puntos tenga al final gana.</p></div></div>
      <button class="bg" style="margin-top:4px" onclick="closeModal('m-instr')">Entendido, a jugar</button>
    </div>
  </div>
</div>

<!-- MODAL EQUIPO INFO -->
<div class="modal-ov" id="m-qinfo" onclick="closeModal('m-qinfo')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-hdr"><div class="modal-title">Puntuaci√≥n del Equipo</div><div class="modal-close" onclick="closeModal('m-qinfo')">‚úï</div></div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--gl);line-height:1.6;margin-bottom:14px">El equipo es la alineaci√≥n de miembros de tu liga que apuestas que rendir√°n mejor en el siguiente periodo.</p>
      <div style="background:var(--card);border:1px solid rgba(239,184,16,.2);border-radius:12px;padding:14px;margin-bottom:10px">
        <div style="font-size:11px;font-weight:800;color:var(--gold);letter-spacing:1px;margin-bottom:8px">TITULARES</div>
        <p style="font-size:12px;color:var(--gl);line-height:1.5">Son los jugadores que apuestas que completar√°n m√°s retos. Cada titular recibe los puntos configurados al crear la liga por cada periodo activo.</p>
      </div>
      <div style="background:var(--card);border:1px solid #1e1e1e;border-radius:12px;padding:14px;margin-bottom:14px">
        <div style="font-size:11px;font-weight:800;color:var(--gl);letter-spacing:1px;margin-bottom:8px">SUPLENTES</div>
        <p style="font-size:12px;color:var(--gl);line-height:1.5">Reciben menos puntos por periodo. Si un titular no completa ning√∫n reto ese periodo, los suplentes no se activan autom√°ticamente.</p>
      </div>
      <p style="font-size:11px;color:var(--gray);line-height:1.5;padding:10px;background:#0a0a0a;border-radius:10px">Estos valores se configuran al crear la liga y el admin puede actualizarlos en cualquier momento.</p>
      <button class="bg" style="margin-top:14px" onclick="closeModal('m-qinfo')">Entendido</button>
    </div>
  </div>
</div>

<!-- MODAL TROPHY -->
<div class="modal-ov" id="m-trophy" onclick="closeModal('m-trophy')">
  <div class="modal-box" onclick="event.stopPropagation()" style="max-height:92vh">
    <div class="modal-hdr"><div class="modal-title">Solicitar Trofeo</div><div class="modal-close" onclick="closeModal('m-trophy')">‚úï</div></div>
    <div class="modal-body">
      <div style="text-align:center;padding:16px 0">
        <div class="trophy-prev-wrap"><span id="trophy-emoji">üèÜ</span></div>
        <div class="trophy-name-prev" id="trophy-name-prev">CarlosGOAT</div>
        <div class="trophy-season-prev" id="trophy-season-prev">Temporada 2026</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:20px">
        <div class="iw"><label class="il">Nombre en el trofeo</label><input class="inp" id="trophy-name-inp" value="CarlosGOAT" oninput="updateTrophyPreview()"></div>
        <div class="iw"><label class="il">Temporada</label><input class="inp" id="trophy-season-inp" value="Temporada 2026" oninput="updateTrophyPreview()"></div>
      </div>
      <div style="font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--gray);font-weight:700;margin-bottom:12px">Elige tu trofeo</div>
      <div class="t-prod sel" id="tp-1" onclick="selectTrophy(1)"><div class="t-img">üèÜ</div><div style="flex:1"><div class="t-name">Trofeo Cl√°sico</div><div class="t-desc">Resina dorada ¬∑ 20cm ¬∑ grabado l√°ser</div><div class="t-price">29,90 ‚Ç¨</div></div><div class="chk">‚úì</div></div>
      <div class="t-prod" id="tp-2" onclick="selectTrophy(2)"><div class="t-img">üêê</div><div style="flex:1"><div class="t-name">GOAT Edition</div><div class="t-desc">Cabra dorada premium ¬∑ 25cm</div><div class="t-price">49,90 ‚Ç¨</div></div><div class="chk">‚úì</div></div>
      <div class="t-prod" id="tp-3" onclick="selectTrophy(3)"><div class="t-img">üëë</div><div style="flex:1"><div class="t-name">Trofeo √âlite</div><div class="t-desc">Metal chapado en oro ¬∑ 30cm ¬∑ pedestal madera</div><div class="t-price">89,90 ‚Ç¨</div></div><div class="chk">‚úì</div></div>
      <div class="t-prod" id="tp-4" onclick="selectTrophy(4)"><div class="t-img">üìú</div><div style="flex:1"><div class="t-name">Diploma Enmarcado</div><div class="t-desc">Certificado oficial Fantasy GOAT ¬∑ 30x21cm</div><div class="t-price">19,90 ‚Ç¨</div></div><div class="chk">‚úì</div></div>
      <button class="bg" style="margin-top:16px" onclick="orderTrophy()">Pedir Trofeo ¬∑ <span id="trophy-price-btn">29,90 ‚Ç¨</span></button>
      <p style="font-size:10px;color:var(--gray);text-align:center;margin-top:10px;line-height:1.4">Env√≠o en 7‚Äì10 d√≠as h√°biles ¬∑ Pago seguro</p>
    </div>
  </div>
</div>

<!-- MODAL FEEDBACK -->
<div class="modal-ov" id="m-feedback" onclick="closeModal('m-feedback')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-hdr"><div class="modal-title">Comentario</div><div class="modal-close" onclick="closeModal('m-feedback')">‚úï</div></div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--gl);margin-bottom:14px;line-height:1.5">Cu√©ntanos qu√© piensas de Fantasy GOAT. Tu opini√≥n nos ayuda a mejorar la app.</p>
      <div class="iw" style="margin-bottom:14px">
        <label class="il">Tu mensaje</label>
        <textarea class="inp" id="fb-text" style="min-height:150px" maxlength="2000" placeholder="Escribe aqu√≠..." oninput="document.getElementById('fb-count').textContent=this.value.length"></textarea>
        <div style="text-align:right;font-size:10px;color:var(--gray);margin-top:4px"><span id="fb-count">0</span>/2000</div>
      </div>
      <button class="bg" onclick="sendFeedback()">Enviar comentario</button>
    </div>
  </div>
</div>

<!-- MODAL ABOUT -->
<div class="modal-ov" id="m-about" onclick="closeModal('m-about')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-hdr"><div class="modal-title">Sobre Fantasy GOAT</div><div class="modal-close" onclick="closeModal('m-about')">‚úï</div></div>
    <div class="modal-body">
      <div style="text-align:center;margin-bottom:20px"><div style="font-size:48px;margin-bottom:8px">üêê</div><div style="font-family:'Bebas Neue',cursive;font-size:28px;letter-spacing:4px;color:var(--gold)">FANTASY GOAT</div><p style="font-size:11px;color:var(--gray);letter-spacing:2px;text-transform:uppercase;margin-top:4px">Versi√≥n 1.0.0</p></div>
      <div class="about-block"><div class="about-block-title">¬øQU√â ES?</div><p class="about-block-body">Fantasy GOAT es una plataforma de retos de la vida real entre amigos, inspirada en las ligas de fantasy sports. En lugar de apostar por jugadores de f√∫tbol, apuestas por tus amigos y por ti mismo para superar desaf√≠os del d√≠a a d√≠a: maratones, noches de fiesta, flexiones, libros, cocina y todo lo que os propong√°is.</p></div>
      <div class="about-block"><div class="about-block-title">¬øPOR QU√â SE CRE√ì?</div><p class="about-block-body">Naci√≥ de una idea simple: hacer que la competici√≥n amistosa sea m√°s divertida, estructurada y memorable. Queremos que las personas se motiven a hacer cosas incre√≠bles gracias a la presi√≥n positiva del grupo, la recompensa de los puntos y el orgullo de ganar una temporada.</p></div>
      <div class="about-block"><div class="about-block-title">C√ìMO SACARLE EL M√ÅXIMO</div><p class="about-block-body">Fantasy GOAT funciona mejor cuando los retos son honestos, divertidos y alcanzables para todos. El √°rbitro debe ser imparcial al validar pruebas. Prop√≥n retos creativos, celebra los logros del grupo y recuerda que el esp√≠ritu es competir con respeto y pas√°rselo bien juntos.</p></div>
      <p style="font-size:10px;color:var(--gray);text-align:center;margin-top:4px">Hecho con trabajo y ganas ¬∑ Santander, Espa√±a</p>
    </div>
  </div>
</div>

<!-- LEAGUE SHEET -->
<div class="sheet-ov" id="league-sheet" onclick="closeSheet()">
  <div class="sheet-box" id="sheet-box">
    <div class="sheet-handle"></div>
    <div class="sheet-title" id="sheet-league-name">‚Äî</div>
    <div class="sheet-btn" onclick="toast('Enlace copiado');closeSheet()">Compartir liga</div>
    <div class="sheet-btn" onclick="toast('Ajustes...');closeSheet()">Ajustes de la liga</div>
    <div class="sheet-btn danger" onclick="showLeaveConfirm()">Salirse de la liga</div>
    <div class="sheet-btn danger" onclick="showDeleteConfirm()">Eliminar la liga</div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
var CUR='s-login',PREV=null,TT=null;
var pickedUser=null,currentView='list',tkIdx=0,tkStartY=0;
var selectedTrophy=1;
var TROPHY_PRICES={1:'29,90 ‚Ç¨',2:'49,90 ‚Ç¨',3:'89,90 ‚Ç¨',4:'19,90 ‚Ç¨'};
var TROPHY_EMOJIS={1:'üèÜ',2:'üêê',3:'üëë',4:'üìú'};
var qSize=5,starterPts=10,benchPts=4;
var currentLeague={name:'',idx:0};
var dragSrc=null,pickerCtx={type:'tit',idx:0};
var titulares=[0,1,2,3,null],banquillo=[4,5,null,null];
var LANG='es';

var PLAYERS=[];
var subs=[];
var RANK={global:[],feb:[],ene:[],dic:[],nov:[]};

function go(id){
  if(id===CUR)return;
  if(id!=='s-login') localStorage.setItem('fg_screen',id);
  var c=document.getElementById(CUR),n=document.getElementById(id);
  if(!n)return;
  c.classList.remove('active');c.classList.add('prev');
  setTimeout(function(){c.classList.remove('prev');},380);
  n.classList.add('active');n.scrollTop=0;
  PREV=CUR;CUR=id;
  if(id==='s-ranking'){ 
    if(window._fsCargarRanking && window.ligaActual) window._fsCargarRanking(window.ligaActual.id); 
    else renderRanking(); 
  }
  if(id==='s-home')renderFeed();
  if(id==='s-equipo')renderEquipo();
}
function goBack(){if(PREV)go(PREV);}
function nav(id,idx){
  go(id);
  setTimeout(function(){
    var sc=document.getElementById(id);if(!sc)return;
    sc.querySelectorAll('.ni').forEach(function(el,i){el.classList.toggle('active',i===idx);});
    sc.querySelectorAll('.nc').forEach(function(c){c.classList.toggle('active',idx===2);});
  },10);
}
function toast(msg){
  var t=document.getElementById('toast');
  document.getElementById('t-msg').textContent=msg;
  t.classList.add('show');
  if(TT)clearTimeout(TT);
  TT=setTimeout(function(){t.classList.remove('show');},2200);
}
function openModal(id){document.getElementById(id).classList.add('show');}
function closeModal(id){document.getElementById(id).classList.remove('show');}

function openLeagueSheet(name,idx){
  currentLeague={name:name,idx:idx};
  document.getElementById('sheet-league-name').textContent=name;
  resetSheet();
  document.getElementById('league-sheet').classList.add('show');
}
function closeSheet(){document.getElementById('league-sheet').classList.remove('show');}
function resetSheet(){
  var id = currentLeague.id || '';
  var shareBtn = id
    ? '<div class="sheet-btn" onclick="compartirSheetLiga()">Compartir liga</div>'
    : '<div class="sheet-btn" onclick="toast(\'Sin ID disponible\');closeSheet()">Compartir liga</div>';
  document.getElementById('sheet-box').innerHTML=
    '<div class="sheet-handle"></div>'+
    '<div class="sheet-title" id="sheet-league-name">'+currentLeague.name+'</div>'+
    shareBtn+
    '<div class="sheet-btn" onclick="toast(\'Pr√≥ximamente\');closeSheet()">Ajustes de la liga</div>'+
    '<div class="sheet-btn danger" onclick="showLeaveConfirm()">Salirse de la liga</div>'+
    '<div class="sheet-btn danger" onclick="showDeleteConfirm()">Eliminar la liga</div>';
}
function compartirSheetLiga(){
  var id = currentLeague.id;
  if(!id){ toast("Sin ID"); return; }
  var url = getLigaUrl(id);
  navigator.clipboard.writeText(url).then(function(){ toast("Enlace copiado"); }).catch(function(){ toast("Enlace: "+url); });
  closeSheet();
}
function showLeaveConfirm(){
  document.getElementById('sheet-box').innerHTML=
    '<div class="sheet-handle"></div>'+
    '<div style="font-size:15px;font-weight:800;color:var(--white);margin-bottom:8px">¬øSalir de "'+currentLeague.name+'"?</div>'+
    '<div style="font-size:12px;color:var(--gray);margin-bottom:20px;line-height:1.4">Perder√°s acceso al historial de la liga.</div>'+
    '<div style="display:flex;gap:10px">'+
      '<button class="bw" style="padding:12px;font-size:12px" onclick="closeSheet()">Cancelar</button>'+
      '<button class="bdanger" style="padding:12px;font-size:12px" onclick="doLeave()">S√≠, salir</button>'+
    '</div>';
}
function showDeleteConfirm(){
  document.getElementById('sheet-box').innerHTML=
    '<div class="sheet-handle"></div>'+
    '<div style="font-size:15px;font-weight:800;color:var(--red);margin-bottom:8px">¬øEliminar "'+currentLeague.name+'"?</div>'+
    '<div style="font-size:12px;color:var(--gray);margin-bottom:20px;line-height:1.4">Esta acci√≥n es irreversible. Se borrar√°n todos los datos de la liga.</div>'+
    '<div style="display:flex;gap:10px">'+
      '<button class="bw" style="padding:12px;font-size:12px" onclick="closeSheet()">Cancelar</button>'+
      '<button class="bdanger" style="padding:12px;font-size:12px" onclick="doDelete()">S√≠, eliminar</button>'+
    '</div>';
}

function setTipo(t,el){
  document.getElementById('f-pass').classList.toggle('show',t==='priv');
  document.getElementById('f-id').classList.toggle('show',t==='pub');
  el.parentNode.querySelectorAll('.pill').forEach(function(p){p.classList.remove('active');});
  el.classList.add('active');
}
function setPeriod(el){
  el.parentNode.querySelectorAll('.pill').forEach(function(p){p.classList.remove('active');});
  el.classList.add('active');
}
function setQSize(n,el){
  qSize=n;
  document.querySelectorAll('.q-size-btn').forEach(function(b){b.classList.remove('active');});
  el.classList.add('active');
}

function setLang(l){
  LANG=l;
  ['es','en','fr'].forEach(function(c){
    var b=document.getElementById('lb-'+c);
    if(b)b.classList.toggle('active',c===l);
  });
  toast(l==='es'?'Idioma: Espa√±ol':l==='en'?'Language: English':'Langue: Fran√ßais');
}

function setView(v){
  currentView=v;
  document.getElementById('vb-list').classList.toggle('active',v==='list');
  document.getElementById('vb-feed').classList.toggle('active',v==='feed');
  document.getElementById('list-view').style.display=v==='list'?'block':'none';
  var tw=document.getElementById('tiktok-wrap');
  if(v==='feed'){tw.classList.add('show');renderTikTok();}
  else tw.classList.remove('show');
}
function renderFeed(){
  var ff=document.getElementById('forum-feed');ff.innerHTML='';
  if(!subs.length){
    ff.innerHTML='<div style="text-align:center;padding:48px 20px;color:var(--gray)"><div style="font-size:36px;margin-bottom:12px">üì≠</div><div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin actividad todav√≠a</div><div style="font-size:11px;line-height:1.5">Los retos completados por los miembros aparecer√°n aqu√≠</div></div>';
    return;
  }
  subs.forEach(function(s){
    var badge=s.status==='pending'?'<span class="badge b-rev">Pendiente</span>':s.status==='approved'?'<span class="badge b-ok">Aprobado</span>':'<span class="badge b-no">Rechazado</span>';
    var vbar=s.status==='pending'?'<div class="vbar"><div class="vbtn2 vok" onclick="approvePost(this)">Aprobar</div><div class="vbtn2 vno" onclick="rejectPost(this)">Rechazar</div></div>':'';
    ff.innerHTML+='<div class="fp">'+
      '<div class="fp-hdr"><div class="av">'+s.emoji+'</div><div><div class="fp-user">'+s.user+'</div><div class="fp-reto">'+s.reto+'</div></div><div class="fp-time">'+s.time+'</div></div>'+
      '<div class="fp-media"><span>'+s.emoji+'</span><span class="media-tag">'+s.mediaType+'</span></div>'+
      vbar+
      '<div class="fp-foot"><div class="fp-desc">'+s.desc+'</div><div class="fp-btns">'+badge+'<div class="fp-btn">+'+s.pts+' pts</div></div></div>'+
    '</div>';
  });
}
function approvePost(el){el.closest('.vbar').innerHTML='<div style="padding:4px 14px;font-size:11px;font-weight:700;color:var(--green)">Aprobado</div>';}
function rejectPost(el){el.closest('.vbar').innerHTML='<div style="padding:4px 14px;font-size:11px;font-weight:700;color:var(--red)">Rechazado</div>';}

function renderTikTok(){
  var tw=document.getElementById('tiktok-wrap');tw.innerHTML='';
  // Empty state
  if(!subs.length){
    tw.innerHTML=
      '<div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;background:var(--black)">'+
        '<div style="font-size:40px">üì≠</div>'+
        '<div style="font-size:14px;font-weight:700;color:var(--white)">Sin actividad todav√≠a</div>'+
        '<div style="font-size:11px;color:var(--gray);text-align:center;padding:0 32px;line-height:1.5">Los retos completados por los miembros aparecer√°n aqu√≠</div>'+
        '<button onclick="setView(\'list\')" style="margin-top:8px;padding:12px 28px;background:var(--gold);color:#000;border:none;border-radius:12px;font-family:Montserrat,sans-serif;font-weight:900;font-size:13px;letter-spacing:1px;cursor:pointer">Volver al foro</button>'+
      '</div>';
    return;
  }
  subs.forEach(function(s,i){
    var slide=document.createElement('div');slide.className='tk-slide';slide.style.transform='translateY('+(i===0?0:100)+'%)';
    slide.innerHTML='<div class="tk-bg"><span>'+s.emoji+'</span></div><div class="tk-grad"></div>'+
      '<div class="tk-info"><div class="tk-reto">'+s.reto+'</div><div class="tk-user">@'+s.user+'</div></div>'+
      '<div class="tk-ctr">'+(i+1)+'/'+subs.length+'</div>'+
      '<div class="tk-back" onclick="setView(\'list\')">‚Äπ</div>'+
      '<div class="tk-side">'+
        '<div class="tk-sb"><div class="tk-ico">üëç</div><div class="tk-tl">Me gusta</div></div>'+
      '</div>';
    tw.appendChild(slide);
  });
  tkIdx=0;
  tw.addEventListener('touchstart',function(e){tkStartY=e.touches[0].clientY;},{passive:true});
  tw.addEventListener('touchend',function(e){
    var dy=tkStartY-e.changedTouches[0].clientY;
    if(Math.abs(dy)<40)return;
    var slides=tw.querySelectorAll('.tk-slide');
    if(dy>0&&tkIdx<slides.length-1)tkIdx++;
    else if(dy<0&&tkIdx>0)tkIdx--;
    slides.forEach(function(s,i){s.style.transform='translateY('+(i-tkIdx)*100+'%)';});
    tw.querySelector('.tk-ctr').textContent=(tkIdx+1)+'/'+slides.length;
  });
}

function switchTab(t){
  document.getElementById('gtab-r').classList.toggle('active',t==='r');
  var vtab = document.getElementById('gtab-v');
  if(vtab) vtab.classList.toggle('active',t==='v');
  document.getElementById('gtab-p').classList.toggle('active',t==='p');
  document.getElementById('gpanel-r').style.display=t==='r'?'flex':'none';
  var vpanel = document.getElementById('gpanel-v');
  if(vpanel) vpanel.style.display=t==='v'?'flex':'none';
  document.getElementById('gpanel-p').style.display=t==='p'?'flex':'none';
  // Load completados when switching to validar tab
  if(t==='v' && window._fsCargarCompletados && window.ligaActual) {
    window._fsCargarCompletados(window.ligaActual.id);
  }
}
function selPred(el){el.parentNode.querySelectorAll('.pred-opt').forEach(function(o){o.classList.remove('sel');});el.classList.add('sel');}

function openComp(name,creator,pts){
  document.getElementById('comp-name').textContent=name;
  document.getElementById('comp-creator').textContent='@'+creator;
  var neg=pts<0;
  document.getElementById('comp-pts').textContent=pts;
  document.getElementById('comp-pts').className='pts-n'+(neg?' neg':'');
  document.getElementById('comp-pts-badge').className='pts-badge'+(neg?' neg-badge':'');
  document.getElementById('comp-text').value='';
  clearMedia('img');clearMedia('vid');
  go('s-completar');
}
function handleImg(e){
  var f=e.target.files[0];if(!f)return;
  var r=new FileReader();r.onload=function(ev){
    document.getElementById('img-el').src=ev.target.result;
    document.getElementById('img-prev').style.display='block';
    document.getElementById('img-area').style.display='none';
  };r.readAsDataURL(f);
}
function handleVid(e){
  var f=e.target.files[0];if(!f)return;
  document.getElementById('vid-el').src=URL.createObjectURL(f);
  document.getElementById('vid-prev').style.display='block';
  document.getElementById('vid-area').style.display='none';
}
function clearMedia(t){
  if(t==='img'){document.getElementById('img-prev').style.display='none';document.getElementById('img-area').style.display='block';document.getElementById('img-el').src='';}
  else{document.getElementById('vid-prev').style.display='none';document.getElementById('vid-area').style.display='block';document.getElementById('vid-el').src='';}
}
function submitReto(){
  var prueba = document.getElementById('comp-text').value.trim();
  if(!prueba){ toast('Escribe una justificaci√≥n'); return; }
  if(window.submitCompletado) window.submitCompletado(prueba);
}
function submitRetoSin(){
  if(window.submitCompletado) window.submitCompletado('Sin prueba proporcionada');
}

function renderRanking(){
  var sel=document.getElementById('rank-filter').value;
  var isG=sel==='global';
  document.getElementById('rank-global-label').style.display=isG?'block':'none';
  var data=RANK[sel]||[];
  var top3=document.getElementById('rank-top3');var list=document.getElementById('rank-list');
  top3.innerHTML='';list.innerHTML='';
  if(!data.length){
    list.innerHTML='<div style="text-align:center;padding:48px 20px;color:var(--gray)"><div style="font-size:36px;margin-bottom:12px">üèÜ</div><div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin datos todav√≠a</div><div style="font-size:11px;line-height:1.5">El ranking se llenar√° cuando los miembros completen retos</div></div>';
    return;
  }
  if(data.length>=2){
    var order=data.length>=3?[data[1],data[0],data[2]]:[data[1],data[0]];
    var classes=['p2','p1','p3'],bars=['pb2','pb1','pb3'],nums=['2','1','3'];
    order.forEach(function(p,i){
      var real=i===1;
      top3.innerHTML+='<div class="pod-item">'+
        (real?'<div style="font-size:18px;margin-bottom:2px">üëë</div>':'')+
        '<div class="pod-av '+classes[i]+'">'+p.emoji+'</div>'+
        '<div style="font-size:10px;font-weight:700;color:var(--white);text-align:center;margin-top:3px">'+p.name+'</div>'+
        '<div style="font-size:9px;color:var(--gold);font-family:\'Bebas Neue\',cursive">'+p.pts.toLocaleString()+'</div>'+
        '<div class="pod-bar '+bars[i]+'"><span class="pod-n">'+nums[i]+'</span></div>'+
      '</div>';
    });
  }
  data.forEach(function(p,i){
    if(i<3)return;
    var col=i===0?'var(--gold)':i===1?'#aaa':i===2?'#a0522d':'var(--gl)';
    list.innerHTML+='<div class="rrow">'+
      '<div class="rn" style="color:'+col+'">'+(i+1)+'</div>'+
      '<div class="r-av">'+p.emoji+'</div>'+
      '<div style="flex:1"><div style="font-size:13px;font-weight:700;color:var(--white)">'+p.name+'</div><div style="font-size:10px;color:var(--gray)">'+p.retos+' retos</div></div>'+
      '<div class="r-pts" style="color:'+col+'">'+p.pts.toLocaleString()+'</div>'+
    '</div>';
  });
}

function renderEquipo(){
  var sp=parseInt((document.getElementById('starter-pts')||{}).value)||10;
  var bp=parseInt((document.getElementById('bench-pts')||{}).value)||4;
  starterPts=sp;benchPts=bp;
  document.getElementById('ip-starter-pts').textContent='+'+sp;
  document.getElementById('ip-bench-pts').textContent='+'+bp;
  renderCourt();renderBench();
}
function renderCourt(){
  var grid=document.getElementById('court-grid');grid.innerHTML='';
  var size=Math.min(qSize,5);
  var tits=titulares.slice(0,size);
  var rows=size<=2?[tits]:size===3?[[tits[0]],[tits[1],tits[2]]]:size===4?[[tits[0],tits[1]],[tits[2],tits[3]]]:[[tits[0]],[tits[1],tits[2]],[tits[3],tits[4]]];
  rows.forEach(function(row,ri){
    var rowDiv=document.createElement('div');rowDiv.className='prow';
    row.forEach(function(pIdx,ci){
      var slot=document.createElement('div');slot.className='pslot';slot.draggable=true;
      var p=(pIdx!==null&&pIdx!==undefined)?PLAYERS[pIdx]:null;
      slot.innerHTML='<div class="pcirc '+(p?'tit':'emp')+'">'+(p?'<span class="emoji">'+p.emoji+'</span>':'')+'</div>'+
        '<div class="pname">'+(p?p.name:'Vac√≠o')+'</div>'+
        (p?'<div class="ppts">+'+starterPts+' pts</div>':'');
      var gi=0;for(var r2=0;r2<ri;r2++)gi+=rows[r2].length;gi+=ci;
      slot.onclick=(function(g){return function(){openPicker('tit',g);};})(gi);
      addDrag(slot,'tit',gi);
      rowDiv.appendChild(slot);
    });
    grid.appendChild(rowDiv);
  });
}
function renderBench(){
  var br=document.getElementById('bench-row');br.innerHTML='';
  banquillo.forEach(function(pIdx,i){
    var p=(pIdx!==null&&pIdx!==undefined)?PLAYERS[pIdx]:null;
    var slot=document.createElement('div');slot.className='bslot';
    slot.innerHTML='<div class="bcirc '+(p?'filled':'emp2')+'">'+(p?'<span style="font-size:18px">'+p.emoji+'</span>':'')+'</div>'+
      '<div class="bname">'+(p?p.name:'‚Äî')+'</div>'+
      (p?'<div style="font-size:8px;color:var(--gray);font-weight:600">+'+benchPts+'</div>':'');
    slot.onclick=(function(bi){return function(){openPicker('bench',bi);};})(i);
    addDrag(slot,'bench',i);
    br.appendChild(slot);
  });
}
function addDrag(el,type,idx){
  el.addEventListener('dragstart',function(e){dragSrc={type:type,idx:idx};el.classList.add('dragging');e.dataTransfer.effectAllowed='move';});
  el.addEventListener('dragend',function(){el.classList.remove('dragging');document.querySelectorAll('.drag-over').forEach(function(d){d.classList.remove('drag-over');});});
  el.addEventListener('dragover',function(e){e.preventDefault();el.classList.add('drag-over');});
  el.addEventListener('dragleave',function(){el.classList.remove('drag-over');});
  el.addEventListener('drop',function(e){e.preventDefault();el.classList.remove('drag-over');if(!dragSrc)return;doSwap(type,idx);});
}
function doSwap(destType,destIdx){
  var srcArr=dragSrc.type==='tit'?titulares:banquillo;
  var dstArr=destType==='tit'?titulares:banquillo;
  var tmp=srcArr[dragSrc.idx];srcArr[dragSrc.idx]=dstArr[destIdx];dstArr[destIdx]=tmp;
  dragSrc=null;renderCourt();renderBench();
}
function toggleInfo(e){e.stopPropagation();document.getElementById('info-popup').classList.toggle('show');}
document.addEventListener('click',function(){var p=document.getElementById('info-popup');if(p)p.classList.remove('show');});

function openPicker(type,idx){
  pickerCtx={type:type,idx:idx};
  document.getElementById('pick-slot').textContent=(type==='tit'?'Titular ':'Suplente ')+(idx+1);
  var ul=document.querySelector('.ulist');
  ul.innerHTML='';
  if(!PLAYERS.length){
    ul.innerHTML='<div style="text-align:center;padding:24px;color:var(--gray);font-size:12px">No hay miembros en la liga todav√≠a</div>';
  } else {
    PLAYERS.forEach(function(p){
      var row=document.createElement('div');row.className='upick';
      row.innerHTML='<div class="u-av" style="background:'+p.bg+';color:'+p.col+'">'+p.init+'</div><div class="upick-name">'+p.name+'</div><div class="upick-pts">'+p.pts+'</div>';
      row.onclick=function(){selUser(row,p.name,p.pts,p.emoji);};
      ul.appendChild(row);
    });
  }
  document.querySelectorAll('.upick').forEach(function(u){u.classList.remove('sel');});
  pickedUser=null;
  document.getElementById('picker').classList.add('show');
}
function closePicker(){document.getElementById('picker').classList.remove('show');pickedUser=null;}
function selUser(el,name,pts,emoji){
  document.querySelectorAll('.upick').forEach(function(u){u.classList.remove('sel');});
  el.classList.add('sel');
  pickedUser={name:name,pts:pts,emoji:emoji};
}
function confirmPick(){
  if(!pickedUser){closePicker();return;}
  var pi=PLAYERS.findIndex(function(p){return p.name===pickedUser.name;});
  if(pickerCtx.type==='tit')titulares[pickerCtx.idx]=pi;
  else banquillo[pickerCtx.idx]=pi;
  closePicker();renderCourt();renderBench();
}

function updateTrophyPreview(){
  document.getElementById('trophy-name-prev').textContent=document.getElementById('trophy-name-inp').value||'Tu nombre';
  document.getElementById('trophy-season-prev').textContent=document.getElementById('trophy-season-inp').value||'Temporada';
}
function selectTrophy(n){
  selectedTrophy=n;
  [1,2,3,4].forEach(function(i){document.getElementById('tp-'+i).classList.toggle('sel',i===n);});
  document.getElementById('trophy-price-btn').textContent=TROPHY_PRICES[n];
  document.getElementById('trophy-emoji').textContent=TROPHY_EMOJIS[n];
}
function orderTrophy(){
  toast('Pedido enviado ¬∑ '+TROPHY_PRICES[selectedTrophy]);
  closeModal('m-trophy');
}

function sendFeedback(){
  var txt=document.getElementById('fb-text').value.trim();
  if(!txt){toast('Escribe algo antes de enviar');return;}
  toast('Comentario enviado. ¬°Gracias!');
  document.getElementById('fb-text').value='';
  document.getElementById('fb-count').textContent='0';
  closeModal('m-feedback');
}

// ‚îÄ‚îÄ Helpers (used by Firestore functions) ‚îÄ‚îÄ
window.ligaActual = null;

function genId() {
  var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  var id = 'GOAT-';
  for(var i=0;i<5;i++) id += chars[Math.floor(Math.random()*chars.length)];
  return id;
}
function getLigaUrl(id) {
  // Use your GitHub Pages URL directly
  var baseUrl = 'https://chemaabravoo.github.io/fantasyGoat/';
  // Fallback to current location if not on GitHub Pages
  if(window.location.href.indexOf('chemaabravoo.github.io') === -1) {
    baseUrl = window.location.href.split('?')[0].split('#')[0];
    if(!baseUrl.endsWith('/')) baseUrl += '/';
  }
  return baseUrl + '?liga=' + id;
}
function copiarId() {
  var id = document.getElementById('invite-id-display').textContent;
  navigator.clipboard.writeText(id).then(function(){ toast('ID copiado: ' + id); }).catch(function(){ toast('ID: ' + id); });
}
function copiarEnlace() {
  var id = document.getElementById('invite-id-display').textContent;
  var url = getLigaUrl(id);
  console.log('[DEBUG] Generated URL:', url);
  navigator.clipboard.writeText(url).then(function(){ toast('Enlace copiado'); }).catch(function(){ toast('No se pudo copiar'); });
}
function compartirWhatsApp() {
  var id  = document.getElementById('invite-id-display').textContent;
  var url = getLigaUrl(id);
  var txt = encodeURIComponent('¬°√önete a mi liga Fantasy GOAT!\nID: ' + id + '\n' + url);
  window.open('https://wa.me/?text=' + txt, '_blank');
}
// Detect invite link from URL
(function(){
  var params = new URLSearchParams(window.location.search);
  var ligaId = params.get('liga');
  console.log('[DEBUG] URL:', window.location.href);
  console.log('[DEBUG] Liga param:', ligaId);
  if(ligaId) {
    window._pendingJoinId = ligaId.toUpperCase();
    console.log('[DEBUG] Pending join ID set:', window._pendingJoinId);
  }
})();

// ‚ïê‚ïê RETOS (Firestore) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Estructura: /ligas/{ligaId}/retos/{retoId}
//   { titulo, pts, desc, creador, creadorNombre, creada }

function publicarReto() {
  var titulo = document.getElementById('reto-titulo').value.trim();
  var pts    = parseInt(document.getElementById('reto-pts').value);
  var desc   = document.getElementById('reto-desc').value.trim();
  if(!titulo)             { toast('Escribe el t√≠tulo del reto'); return; }
  if(isNaN(pts))          { toast('Indica los puntos'); return; }
  if(!window.ligaActual)  { toast('Selecciona una liga primero'); return; }
  var user = window._currentUser;
  if(!user)               { toast('Debes iniciar sesi√≥n'); return; }
  // Call Firestore from module scope via window bridge
  window._fsPublicarReto && window._fsPublicarReto({
    titulo: titulo, pts: pts, desc: desc || '',
    creador: user.uid,
    creadorNombre: user.displayName || user.email.split('@')[0],
    creada: Date.now()
  });
}

function renderRetos(retos) {
  var cont = document.getElementById('retos-list');
  var badge = document.getElementById('retos-pending-badge');
  if(!cont) return;
  
  var user = window._currentUser;
  var isAdmin = user && window.ligaActual && user.uid === window.ligaActual.creador;
  var visibleRetos = isAdmin ? retos : (retos||[]).filter(function(r){ return r.estado === 'activo'; });
  
  if(!visibleRetos || !visibleRetos.length) {
    cont.innerHTML = '<div style="text-align:center;padding:40px 20px;color:var(--gray)"><div style="font-size:36px;margin-bottom:12px">üéØ</div><div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin retos todav√≠a</div><div style="font-size:11px;line-height:1.5">Crea el primer reto de la liga</div></div>';
    if(badge) badge.style.display='none';
    return;
  }
  
  var pendientes = (retos||[]).filter(function(r){ return r.estado==='pendiente'; }).length;
  if(badge && isAdmin && pendientes>0){ 
    badge.style.display='inline-flex'; 
    badge.textContent=pendientes+' pendiente'+(pendientes!==1?'s':''); 
  } else if(badge) { badge.style.display='none'; }
  
  cont.innerHTML = '';
  visibleRetos.forEach(function(r) {
    var neg = r.pts < 0;
    var isPending = r.estado === 'pendiente';
    var div = document.createElement('div'); div.className='rc';
    var safeT = r.titulo.replace(/"/g,'&quot;');
    var safeC = r.creadorNombre.replace(/"/g,'&quot;');
    var statusBadge = isAdmin && isPending ? '<span class="badge b-rev" style="margin-left:8px">Pendiente</span>' : '';
    var buttons = '';
    if(isAdmin && isPending) {
      buttons = '<button class="cbtn2" style="background:#2a2;margin-right:8px" onclick="aprobarReto(''+r.id+'')">Aprobar</button><button class="cbtn2" style="background:#a22" onclick="rechazarReto(''+r.id+'')">Rechazar</button>';
    } else if(!isPending) {
      buttons = '<button class="cbtn2" data-retoid="'+r.id+'" data-titulo="'+safeT+'" data-creator="'+safeC+'" data-pts="'+r.pts+'" onclick="openCompFromBtn(this)">Completar</button>';
    }
    div.innerHTML =
      '<div class="rc-top"><div><div class="rc-title">'+r.titulo+statusBadge+'</div><div class="rc-creator">@'+r.creadorNombre+(r.desc?' ¬∑ '+r.desc:'')+'</div></div><div class="rc-pts'+(neg?' neg':'')+'">'+r.pts+'<span>'+(neg?'penalizaci√≥n':'pts')+'</span></div></div>'+
      '<div class="rc-bot"><div class="rc-who" style="font-size:11px;color:var(--gray)">Por @'+r.creadorNombre+'</div>'+buttons+'</div>';
    cont.appendChild(div);
  });
}

function renderCompletados(completados) {
  var cont = document.getElementById('completados-list');
  var badge = document.getElementById('completados-badge');
  if(!cont) return;
  
  if(!completados || !completados.length) {
    cont.innerHTML = '<div style="text-align:center;padding:40px 20px;color:var(--gray)"><div style="font-size:36px;margin-bottom:12px">‚úÖ</div><div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin completados pendientes</div></div>';
    if(badge) badge.style.display='none';
    return;
  }
  
  if(badge){ badge.style.display='inline-flex'; badge.textContent=completados.length; }
  cont.innerHTML = '';
  
  completados.forEach(function(c) {
    var div = document.createElement('div'); div.className='rc';
    var pts = c.retoPts || 0;
    var neg = pts < 0;
    div.innerHTML =
      '<div class="rc-top">'+
        '<div>'+
          '<div class="rc-title">'+c.retoTitulo+'</div>'+
          '<div class="rc-creator">Completado por @'+c.usuarioNombre+'</div>'+
        '</div>'+
        '<div class="rc-pts'+(neg?' neg':'')+'\">'+pts+'<span>pts</span></div>'+
      '</div>'+
      '<div class="rc-bot">'+
        '<div style="font-size:11px;color:var(--gray);margin-bottom:8px">Prueba: '+c.prueba+'</div>'+
        '<div style="display:flex;gap:8px">'+
          '<button class="cbtn2" style="background:#2a2;flex:1" onclick="aprobarCompletado(\''+c.id+'\')">Aprobar</button>'+
          '<button class="cbtn2" style="background:#a22;flex:1" onclick="rechazarCompletado(\''+c.id+'\')">Rechazar</button>'+
        '</div>'+
      '</div>';
    cont.appendChild(div);
  });
}

// ‚ïê‚ïê FIX: abrirLigaFS tambi√©n actualiza goat/ranking headers ‚ïê‚ïê
function syncLigaUI(l) {
  if(!l) return;
  // Home
  var lname = document.querySelector('#s-home .lname'); if(lname) lname.textContent = l.nombre;
  var lsub  = document.querySelector('#s-home .lsub');  if(lsub)  lsub.textContent  = (l.miembros||[]).length+' jugadores ¬∑ '+l.period;
  // Goat/Retos
  var gname  = document.getElementById('goat-liga-name');  if(gname)  gname.textContent  = l.nombre;
  var gbadge = document.getElementById('goat-liga-badge'); if(gbadge){ gbadge.textContent = l.tipo==='priv'?'Privada':'P√∫blica'; gbadge.className='badge '+(l.tipo==='priv'?'b-priv':'b-pub'); }
  // Ranking header
  var rname = document.querySelector('#s-ranking .lname'); if(rname) rname.textContent = l.nombre;
}

function openCompFromBtn(btn) {
  window._currentRetoId = btn.dataset.retoid;
  openComp(btn.dataset.titulo, btn.dataset.creator, parseInt(btn.dataset.pts));
}

renderFeed();
renderRanking();
// renderLigas is now called from Firebase module after loading user's ligas

</script>

<script type="module">
  import { initializeApp }   from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
           GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, updateProfile }
    from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion, arrayRemove,
           collection, addDoc, getDocs, query, orderBy }
    from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB0-pJ12NXSh4LsdH8AHuK8mg_glWAVrmY",
    authDomain: "fantasy-goat-5d70d.firebaseapp.com",
    projectId: "fantasy-goat-5d70d",
    storageBucket: "fantasy-goat-5d70d.firebasestorage.app",
    messagingSenderId: "191273517968",
    appId: "1:191273517968:web:0a6b63ca46e31ff54b6915",
    measurementId: "G-KY7MHRWWZN"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);
  const provider = new GoogleAuthProvider();

  // ‚îÄ‚îÄ Error messages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function authErr(e) {
    return e.code==='auth/invalid-credential' ? 'Email o contrase√±a incorrectos'
         : e.code==='auth/user-not-found'     ? 'Usuario no encontrado'
         : e.code==='auth/wrong-password'     ? 'Contrase√±a incorrecta'
         : e.code==='auth/email-already-in-use'? 'Este email ya est√° registrado'
         : e.code==='auth/invalid-email'      ? 'Email no v√°lido'
         : e.message;
  }

  function updateUI(user) {
    var name = user.displayName || user.email.split('@')[0];
    ['prof-name','settings-name'].forEach(function(id){
      var el=document.getElementById(id); if(el) el.textContent=name;
    });
    ['prof-email','settings-email'].forEach(function(id){
      var el=document.getElementById(id); if(el) el.textContent=user.email;
    });
  }

  // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  window.fbSignIn = function() {
    var email=document.getElementById('inp-email').value.trim();
    var pass =document.getElementById('inp-pass').value;
    if(!email||!pass){ toast('Rellena email y contrase√±a'); return; }
    signInWithEmailAndPassword(auth,email,pass).catch(function(e){ toast(authErr(e)); });
  };

  window.fbSignUp = function() {
    var email=document.getElementById('inp-email').value.trim();
    var pass =document.getElementById('inp-pass').value;
    if(!email||!pass){ toast('Rellena email y contrase√±a'); return; }
    if(pass.length<6){ toast('Contrase√±a m√≠nimo 6 caracteres'); return; }
    createUserWithEmailAndPassword(auth,email,pass)
      .then(function(cred){ return updateProfile(cred.user,{displayName:email.split('@')[0]}); })
      .catch(function(e){ toast(authErr(e)); });
  };

  window.fbGoogle = function() {
    signInWithPopup(auth,provider)
      .catch(function(e){ if(e.code!=='auth/popup-closed-by-user') toast('Error: '+e.message); });
  };

  window.fbSignOut = function() {
    localStorage.removeItem('fg_screen');
    signOut(auth).then(function(){ go('s-login'); });
  };

  // ‚îÄ‚îÄ Session ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Fallback: if Firebase doesn't respond in 4s, show login
  var authResolved = false;
  setTimeout(function(){
    if(!authResolved){
      console.warn('Firebase auth timeout, forcing login screen');
      go('s-login');
    }
  }, 4000);

  onAuthStateChanged(auth, function(user) {
    authResolved = true;
    if(!user){ go('s-login'); return; }
    updateUI(user);
    window._currentUser = user;
    cargarMisLigas(user.uid).then(function(){
      if(window._pendingJoinId) {
        var inp=document.getElementById('join-id');
        if(inp) inp.value=window._pendingJoinId;
        go('s-join');
      } else {
        // Restore last screen if available
        var saved = localStorage.getItem('fg_screen');
        var safeScreens = ['s-dashboard','s-home','s-ranking','s-goat','s-equipo','s-stats','s-settings'];
        if(saved && safeScreens.indexOf(saved) !== -1) {
          go(saved);
        } else {
          go('s-dashboard');
        }
      }
    }).catch(function(e){
      console.error('cargarMisLigas error:', e);
      go('s-dashboard');
    });
  });

  // ‚îÄ‚îÄ Firestore helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function cargarMisLigas(uid) {
    var snap = await getDoc(doc(db,'usuarios',uid));
    if(!snap.exists()){ renderLigasFS([]); return; }
    var ids = snap.data().ligas || [];
    if(!ids.length){ renderLigasFS([]); return; }
    var ligas = [];
    for(var i=0;i<ids.length;i++){
      var s = await getDoc(doc(db,'ligas',ids[i]));
      if(s.exists()&&!s.data().eliminada) ligas.push(Object.assign({id:ids[i]},s.data()));
    }
    renderLigasFS(ligas);
  }

  function renderLigasFS(ligas) {
    window._ligasFS = ligas;
    var cont = document.getElementById('leagues-list');
    if(!ligas.length){
      cont.innerHTML='<div style="text-align:center;padding:40px 20px;color:var(--gray)"><div style="font-size:36px;margin-bottom:12px">\u{1F3C6}</div><div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">A√∫n no est√°s en ninguna liga</div><div style="font-size:11px;line-height:1.5">Crea una liga o √∫nete con un ID</div></div>';
      return;
    }
    cont.innerHTML='';
    ligas.forEach(function(l,i){
      var bc=l.tipo==='priv'?'b-priv':'b-pub';
      var bt=l.tipo==='priv'?'Privada':'P√∫blica';
      var m=(l.miembros||[]).length;
      var div=document.createElement('div');
      div.className='lcard'; div.id='lc-fs-'+i;
      div.innerHTML=
        '<div class="lcard-body" onclick="abrirLigaFS('+i+')">'+
          '<div>'+
            '<div style="font-size:14px;font-weight:700;color:var(--white);margin-bottom:4px">'+l.nombre+'</div>'+
            '<div style="display:flex;gap:8px;align-items:center">'+
              '<span class="badge '+bc+'">'+bt+'</span>'+
              '<span style="width:3px;height:3px;background:#444;border-radius:50%;display:inline-block"></span>'+
              '<span style="font-size:11px;color:var(--gray)">'+l.period+'</span>'+
            '</div>'+
          '</div>'+
          '<div style="text-align:right"><div style="font-size:11px;color:var(--gray);margin-bottom:4px"><strong style="color:var(--gold)">'+m+'</strong> jugadores</div><span style="color:#444;font-size:14px">‚Ä∫</span></div>'+
        '</div>'+
        '<div class="lcard-dots" onclick="openLeagueSheetFS('+i+')">¬∑¬∑¬∑</div>';
      cont.appendChild(div);
    });
  }

  window.abrirLigaFS = function(idx) {
    var l=(window._ligasFS||[])[idx]; if(!l) return;
    window.ligaActual=l;
    syncLigaUI(l);
    cargarRetos(l.id);
    cargarRanking(l.id);
    cargarCompletados(l.id);
    go('s-home');
  };

  // ‚îÄ‚îÄ Retos ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function cargarRetos(ligaId) {
    if(!ligaId) return;
    try {
      var q = query(collection(db,'ligas',ligaId,'retos'), orderBy('creada','desc'));
      var snap = await getDocs(q);
      var retos = [];
      snap.forEach(function(d){ retos.push(Object.assign({id:d.id},d.data())); });
      renderRetos(retos);
    } catch(e) {
      console.warn('cargarRetos error:', e);
      renderRetos([]);
    }
  }
  window._fsCargarRetos = cargarRetos;

  // ‚îÄ‚îÄ Ranking desde Firestore ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function cargarRanking(ligaId) {
    if(!ligaId) return;
    try {
      var snap = await getDocs(collection(db,'ligas',ligaId,'ranking'));
      var ranking = [];
      snap.forEach(function(d){
        var data = d.data();
        ranking.push({
          uid: d.id,
          name: data.nombre,
          pts: data.puntos || 0,
          retos: data.retosCompletados || 0,
          emoji: 'üë§'
        });
      });
      ranking.sort(function(a,b){ return b.pts - a.pts; });
      window._rankingData = ranking;
      renderRankingFS();
    } catch(e) {
      console.error('cargarRanking error:', e);
    }
  }
  window._fsCargarRanking = cargarRanking;

  function renderRankingFS() {
    var ranking = window._rankingData || [];
    var top3 = document.getElementById('rank-top3');
    var list = document.getElementById('rank-list');
    if(!top3 || !list) return;
    
    top3.innerHTML = '';
    list.innerHTML = '';
    
    if(!ranking.length) {
      list.innerHTML = '<div style="text-align:center;padding:48px 20px;color:var(--gray)"><div style="font-size:36px;margin-bottom:12px">üèÜ</div><div style="font-size:13px;font-weight:700;color:var(--white);margin-bottom:6px">Sin datos todav√≠a</div><div style="font-size:11px;line-height:1.5">El ranking se llenar√° cuando los miembros completen retos</div></div>';
      return;
    }
    
    // Top 3 podium
    if(ranking.length >= 2) {
      var order = ranking.length >= 3 ? [ranking[1], ranking[0], ranking[2]] : [ranking[1], ranking[0]];
      var classes = ['p2','p1','p3'];
      var bars = ['pb2','pb1','pb3'];
      var nums = ['2','1','3'];
      order.forEach(function(p, i) {
        if(!p) return;
        var real = i === 1;
        top3.innerHTML += '<div class="pod-item">' +
          (real ? '<div style="font-size:18px;margin-bottom:2px">üëë</div>' : '') +
          '<div class="pod-av ' + classes[i] + '">' + p.emoji + '</div>' +
          '<div style="font-size:10px;font-weight:700;color:var(--white);text-align:center;margin-top:3px">' + p.name + '</div>' +
          '<div style="font-size:9px;color:var(--gold);font-family:\'Bebas Neue\',cursive">' + p.pts.toLocaleString() + '</div>' +
          '<div class="pod-bar ' + bars[i] + '"><span class="pod-n">' + nums[i] + '</span></div>' +
        '</div>';
      });
    }
    
    // Rest of ranking
    ranking.forEach(function(p, i) {
      if(i < 3) return;
      var col = i === 0 ? 'var(--gold)' : i === 1 ? '#aaa' : i === 2 ? '#a0522d' : 'var(--gl)';
      list.innerHTML += '<div class="rrow">' +
        '<div class="rn" style="color:' + col + '">' + (i + 1) + '</div>' +
        '<div class="r-av">' + p.emoji + '</div>' +
        '<div style="flex:1"><div style="font-size:13px;font-weight:700;color:var(--white)">' + p.name + '</div><div style="font-size:10px;color:var(--gray)">' + p.retos + ' retos</div></div>' +
        '<div class="r-pts" style="color:' + col + '">' + p.pts.toLocaleString() + '</div>' +
      '</div>';
    });
  }

  window._fsPublicarReto = async function(reto) {
    if(!window.ligaActual){ toast('Selecciona una liga primero'); return; }
    try {
      var user = window._currentUser;
      var isAdmin = user && user.uid === window.ligaActual.creador;
      // Admin's retos are auto-approved, others need validation
      reto.estado = isAdmin ? 'activo' : 'pendiente';
      await addDoc(collection(db,'ligas',window.ligaActual.id,'retos'), reto);
      // Clear inputs
      document.getElementById('reto-titulo').value='';
      document.getElementById('reto-pts').value='';
      document.getElementById('reto-desc').value='';
      toast(isAdmin ? 'Reto publicado' : 'Reto enviado para validaci√≥n');
      await cargarRetos(window.ligaActual.id);
      go('s-goat');
    } catch(e) {
      toast('Error al publicar: '+e.message);
    }
  };

  // ‚îÄ‚îÄ Aprobar/Rechazar Retos (solo admin) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  window.aprobarReto = async function(retoId) {
    if(!window.ligaActual){ toast('Sin liga activa'); return; }
    var user = window._currentUser;
    if(!user || user.uid !== window.ligaActual.creador){ toast('Solo el admin puede aprobar'); return; }
    try {
      await updateDoc(doc(db,'ligas',window.ligaActual.id,'retos',retoId), { estado: 'activo' });
      toast('Reto aprobado');
      await cargarRetos(window.ligaActual.id);
    } catch(e) {
      toast('Error: ' + e.message);
    }
  };

  window.rechazarReto = async function(retoId) {
    if(!window.ligaActual){ toast('Sin liga activa'); return; }
    var user = window._currentUser;
    if(!user || user.uid !== window.ligaActual.creador){ toast('Solo el admin puede rechazar'); return; }
    try {
      await updateDoc(doc(db,'ligas',window.ligaActual.id,'retos',retoId), { estado: 'rechazado' });
      toast('Reto rechazado');
      await cargarRetos(window.ligaActual.id);
    } catch(e) {
      toast('Error: ' + e.message);
    }
  };

  // ‚îÄ‚îÄ Completar Reto (guardar prueba) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  window.submitCompletado = async function(prueba) {
    if(!window.ligaActual || !window._currentRetoId){ toast('Error: sin reto activo'); return; }
    var user = window._currentUser;
    if(!user){ toast('Debes iniciar sesi√≥n'); return; }
    try {
      var retoSnap = await getDoc(doc(db,'ligas',window.ligaActual.id,'retos',window._currentRetoId));
      if(!retoSnap.exists()){ toast('Reto no encontrado'); return; }
      var retoData = retoSnap.data();
      
      await addDoc(collection(db,'ligas',window.ligaActual.id,'completados'), {
        retoId: window._currentRetoId,
        retoTitulo: retoData.titulo,
        retoPts: retoData.pts,
        usuarioId: user.uid,
        usuarioNombre: user.displayName || user.email.split('@')[0],
        prueba: prueba,
        estado: 'pendiente_validacion',
        creado: Date.now()
      });
      toast('Enviado para validaci√≥n del admin');
      go('s-goat');
    } catch(e) {
      toast('Error: ' + e.message);
    }
  };

  // ‚îÄ‚îÄ Cargar y Validar Completados (solo admin) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function cargarCompletados(ligaId) {
    if(!ligaId) return;
    var user = window._currentUser;
    var isAdmin = user && window.ligaActual && user.uid === window.ligaActual.creador;
    
    // Show/hide validar tab based on admin status
    var vtab = document.getElementById('gtab-v');
    if(vtab) vtab.style.display = isAdmin ? 'block' : 'none';
    
    if(!isAdmin) return;
    
    try {
      var q = query(collection(db,'ligas',ligaId,'completados'), orderBy('creado','desc'));
      var snap = await getDocs(q);
      var completados = [];
      snap.forEach(function(d){ 
        var data = d.data();
        if(data.estado === 'pendiente_validacion') {
          completados.push(Object.assign({id:d.id}, data)); 
        }
      });
      renderCompletados(completados);
    } catch(e) {
      console.error('cargarCompletados error:', e);
      renderCompletados([]);
    }
  }
  window._fsCargarCompletados = cargarCompletados;

  window.aprobarCompletado = async function(completadoId) {
    if(!window.ligaActual){ toast('Sin liga activa'); return; }
    var user = window._currentUser;
    if(!user || user.uid !== window.ligaActual.creador){ toast('Solo el admin'); return; }
    try {
      var snap = await getDoc(doc(db,'ligas',window.ligaActual.id,'completados',completadoId));
      if(!snap.exists()){ toast('No encontrado'); return; }
      var data = snap.data();
      
      // Mark as approved
      await updateDoc(doc(db,'ligas',window.ligaActual.id,'completados',completadoId), {
        estado: 'aprobado'
      });
      
      // Update ranking - add points
      var rankRef = doc(db,'ligas',window.ligaActual.id,'ranking',data.usuarioId);
      var rankSnap = await getDoc(rankRef);
      if(rankSnap.exists()) {
        var current = rankSnap.data();
        await updateDoc(rankRef, {
          puntos: (current.puntos || 0) + data.retoPts,
          retosCompletados: (current.retosCompletados || 0) + 1,
          ultimaActualizacion: Date.now()
        });
      }
      
      toast('Completado aprobado - ' + data.retoPts + 'pts sumados');
      await cargarCompletados(window.ligaActual.id);
      await cargarRanking(window.ligaActual.id);
    } catch(e) {
      toast('Error: ' + e.message);
    }
  };

  window.rechazarCompletado = async function(completadoId) {
    if(!window.ligaActual){ toast('Sin liga activa'); return; }
    var user = window._currentUser;
    if(!user || user.uid !== window.ligaActual.creador){ toast('Solo el admin'); return; }
    try {
      await updateDoc(doc(db,'ligas',window.ligaActual.id,'completados',completadoId), {
        estado: 'rechazado'
      });
      toast('Completado rechazado');
      await cargarCompletados(window.ligaActual.id);
    } catch(e) {
      toast('Error: ' + e.message);
    }
  };

  window.openLeagueSheetFS = function(idx) {
    var l=(window._ligasFS||[])[idx]; if(!l) return;
    currentLeague={name:l.nombre,idx:idx,id:l.id,creador:l.creador};
    document.getElementById('sheet-league-name').textContent=l.nombre;
    resetSheet();
    document.getElementById('league-sheet').classList.add('show');
  };

  // ‚îÄ‚îÄ Crear liga ‚Üí Firestore ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  window.crearLiga = async function() {
    console.log('[DEBUG crearLiga] Starting...');
    var nombre=document.getElementById('liga-nombre').value.trim();
    if(!nombre){ toast('Ponle un nombre a la liga'); return; }
    var tipo=document.getElementById('tipo-priv').classList.contains('active')?'priv':'pub';
    var pass=tipo==='priv'?document.getElementById('liga-pass').value:'';
    if(tipo==='priv'&&pass.length<6){ toast('La contrase√±a debe tener al menos 6 caracteres'); return; }
    var period=document.getElementById('period-sem').classList.contains('active')?'Semanal':'Mensual';
    var customId=document.getElementById('liga-custom-id')&&document.getElementById('liga-custom-id').value.trim();
    var id=customId?customId.toUpperCase():genId();
    console.log('[DEBUG crearLiga] Generated ID:', id);
    
    var user=window._currentUser;
    if(!user){ toast('Debes iniciar sesi√≥n'); console.log('[DEBUG crearLiga] No user!'); return; }
    console.log('[DEBUG crearLiga] User:', user.uid);

    try {
      // Check ID not taken
      console.log('[DEBUG crearLiga] Checking if ID exists...');
      var existing=await getDoc(doc(db,'ligas',id));
      if(existing.exists()){ toast('Ese ID ya existe, prueba otro'); return; }

      var liga={
        id:id, nombre:nombre, tipo:tipo, pass:pass||'', period:period,
        qSize:qSize,
        starterPts:parseInt(document.getElementById('starter-pts').value)||10,
        benchPts:parseInt(document.getElementById('bench-pts').value)||4,
        creada:Date.now(), miembros:[user.uid], creador:user.uid
      };
      console.log('[DEBUG crearLiga] Liga object:', liga);

      console.log('[DEBUG crearLiga] Saving to Firestore...');
      await setDoc(doc(db,'ligas',id),{
        nombre:liga.nombre, tipo:liga.tipo, pass:liga.pass, period:liga.period,
        qSize:liga.qSize, starterPts:liga.starterPts, benchPts:liga.benchPts,
        creada:liga.creada, miembros:liga.miembros, creador:liga.creador
      });
      console.log('[DEBUG crearLiga] Liga saved!');
      
      // Create ranking entry for creator
      var userName = user.displayName || user.email.split('@')[0];
      await setDoc(doc(db,'ligas',id,'ranking',user.uid), {
        nombre: userName,
        puntos: 0,
        retosCompletados: 0,
        ultimaActualizacion: Date.now()
      });
      console.log('[DEBUG crearLiga] Ranking entry created!');
      
      await setDoc(doc(db,'usuarios',user.uid),{ligas:arrayUnion(id)},{merge:true});
      console.log('[DEBUG crearLiga] User updated!');

      document.getElementById('invite-id-display').textContent=id;
      document.getElementById('invite-url-display').textContent=getLigaUrl(id);
      await cargarMisLigas(user.uid);
      console.log('[DEBUG crearLiga] Success! Going to invite screen...');
      go('s-invite');
    } catch(e) {
      console.error('[DEBUG crearLiga] Error:', e);
      toast('Error al crear liga: ' + e.message);
    }
  };

  // ‚îÄ‚îÄ Unirse a liga ‚Üí Firestore ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  window.unirseALiga = async function() {
    var id   = document.getElementById('join-id').value.trim().toUpperCase();
    var pass = document.getElementById('join-pass').value.trim();
    console.log('[DEBUG unirseALiga] ID:', id, 'Pass:', pass ? '***' : '(empty)');
    
    if(!id){ toast('Introduce el ID de la liga'); return; }
    var user = window._currentUser;
    if(!user){ toast('Debes iniciar sesi√≥n'); return; }
    console.log('[DEBUG unirseALiga] User:', user.uid);

    // Disable button while searching
    var btn = document.querySelector('#s-join .bg');
    if(btn){ btn.disabled=true; btn.textContent='Buscando...'; }

    try {
      console.log('[DEBUG unirseALiga] Fetching liga from Firestore...');
      var snap = await getDoc(doc(db,'ligas',id));
      console.log('[DEBUG unirseALiga] Snap exists:', snap.exists());

      if(!snap.exists()){
        toast('No existe una liga con ese ID');
        console.log('[DEBUG unirseALiga] Liga not found');
        return;
      }

      var data = snap.data();
      console.log('[DEBUG unirseALiga] Liga data:', data);

      if(data.eliminada){
        toast('Esta liga ya no existe');
        return;
      }

      // Check password for private leagues
      if(data.tipo==='priv' && data.pass && data.pass !== pass){
        toast('Contrase√±a incorrecta');
        console.log('[DEBUG unirseALiga] Password mismatch. Expected:', data.pass, 'Got:', pass);
        return;
      }

      // Already a member
      if((data.miembros||[]).includes(user.uid)){
        toast('Ya est√°s en esa liga');
        console.log('[DEBUG unirseALiga] Already a member');
        await cargarMisLigas(user.uid);
        go('s-dashboard');
        return;
      }

      // Join: add uid to liga members and liga id to user doc
      console.log('[DEBUG unirseALiga] Adding user to liga...');
      await updateDoc(doc(db,'ligas',id), { miembros: arrayUnion(user.uid) });
      await setDoc(doc(db,'usuarios',user.uid), { ligas: arrayUnion(id) }, { merge:true });

      // Create ranking entry with 0 points
      console.log('[DEBUG unirseALiga] Creating ranking entry...');
      var userName = user.displayName || user.email.split('@')[0];
      await setDoc(doc(db,'ligas',id,'ranking',user.uid), {
        nombre: userName,
        puntos: 0,
        retosCompletados: 0,
        ultimaActualizacion: Date.now()
      });

      // Reload leagues and navigate
      console.log('[DEBUG unirseALiga] Success! Reloading ligas...');
      await cargarMisLigas(user.uid);
      document.getElementById('join-id').value = '';
      document.getElementById('join-pass').value = '';
      toast('¬°Te has unido a ' + data.nombre + '!');
      go('s-dashboard');

    } catch(e) {
      console.error('[DEBUG unirseALiga] Error:', e);
      if(e.code === 'permission-denied') {
        toast('Sin permiso ‚Äî revisa las reglas de Firestore');
      } else {
        toast('Error: ' + e.message);
      }
    } finally {
      if(btn){ btn.disabled=false; btn.textContent='Buscar y Unirse'; }
    }
  };

  // ‚îÄ‚îÄ Abandonar / Eliminar ‚Üí Firestore ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  window.doLeave = function() {
    closeSheet();
    var user=window._currentUser; if(!user) return;
    updateDoc(doc(db,'ligas',currentLeague.id),{miembros:arrayRemove(user.uid)}).then(function(){
      return setDoc(doc(db,'usuarios',user.uid),{ligas:arrayRemove(currentLeague.id)},{merge:true});
    }).then(function(){ cargarMisLigas(user.uid); toast('"'+currentLeague.name+'" abandonada'); });
  };

  window.doDelete = function() {
    closeSheet();
    var user=window._currentUser; if(!user) return;
    getDoc(doc(db,'ligas',currentLeague.id)).then(function(s){
      if(!s.exists()) return;
      if(s.data().creador!==user.uid){ toast('Solo el creador puede eliminar'); return; }
      return updateDoc(doc(db,'ligas',currentLeague.id),{eliminada:true}).then(function(){
        return setDoc(doc(db,'usuarios',user.uid),{ligas:arrayRemove(currentLeague.id)},{merge:true});
      }).then(function(){ cargarMisLigas(user.uid); toast('"'+currentLeague.name+'" eliminada'); });
    });
  };

</script>

</div>
</body>
</html>